parcelRequire=function(e,r,n,t){function i(n,t){function o(e){return i(o.resolve(e))}function c(r){return e[n][1][r]||r}if(!r[n]){if(!e[n]){var l="function"==typeof parcelRequire&&parcelRequire;if(!t&&l)return l(n,!0);if(u)return u(n,!0);if(f&&"string"==typeof n)return f(n);var p=new Error("Cannot find module '"+n+"'");throw p.code="MODULE_NOT_FOUND",p}o.resolve=c;var a=r[n]=new i.Module(n);e[n][0].call(a.exports,o,a,a.exports,this)}return r[n].exports}function o(e){this.id=e,this.bundle=i,this.exports={}}var u="function"==typeof parcelRequire&&parcelRequire,f="function"==typeof require&&require;i.isParcelRequire=!0,i.Module=o,i.modules=e,i.cache=r,i.parent=u;for(var c=0;c<n.length;c++)i(n[c]);if(n.length){var l=i(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):t&&(this[t]=l)}return i}({8:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,a=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,o=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,i=function(){function i(e){if(n(this,i),!r||!a||!o)throw new Error("您的浏览器不支持indexedDB");return this.name=this.name||e,this.databaseName="myEncapsulation",this}return t(i,[{key:"setDB",value:function(e){var t=this;if(!(e&&e instanceof IDBDatabase))throw new TypeError("参数应是数据库对象");return this.database=e,this.version=this.database.version,this.database.onclose=function(){t.database.isOpen=!1},e}},{key:"closeDB",value:function(){return this.database&&this.database instanceof IDBDatabase&&this.database.close()}},{key:"openDB",value:function(e){var t=this;if(e){if(!Number.isSafeInteger(e))throw new TypeError("版本号只能是整数");if(e<this.version)throw new TypeError("新版本号不能比当前版本号低")}var n=e&&Number.isSafeInteger(e)&&e>this.version?e:this.version;return this.closeDB(),new Promise(function(a,o){var i=e&&Number.isSafeInteger(e)&&e>t.version?r.open(t.databaseName,n):r.open(t.databaseName);i.onsuccess=function(){t.setDB(i.result),t.database.isOpen=!0,a(t.database)},i.onerror=function(e){o(e.target.error)},i.onupgradeneeded=function(e){t.setDB(e.target.result);var n=e.target.transaction;n.objectStoreNames.contains(t.name)||(t.database.createObjectStore(t.name,{keyPath:"id",autoIncrement:!0}),n.objectStore(t.name).createIndex("id","id",{unique:!0}))}})}},{key:"ready",value:function(){var e=this;return this.openDB().then(function(t){return e.setDB(t)})}},{key:"isReady",value:function(){return this.database&&this.database instanceof IDBDatabase&&this.database.isOpen}},{key:"addColumn",value:function(t,n){var a=this;if(!t||"string"!=typeof t)throw new TypeError("索引名称必须存在且为字符串");if(n&&"object"!==(void 0===n?"undefined":e(n)))throw new TypeError("索引选项应是对象类型");var o={};o.unique=n&&n.unique;var i=this.version+1;return this.closeDB(),new Promise(function(e,n){var s=r.open(a.databaseName,i);s.onsuccess=function(){a.setDB(s.result),a.database.isOpen=!0,e(a.database)},s.onerror=function(e){n(e.target.error)},s.onupgradeneeded=function(e){var n=e.target.result,r=e.target.transaction;a.database=n,a.version=a.database.version;var i=r&&r.objectStoreNames.contains(a.name)?r.objectStore(a.name):n.createObjectStore(a.name,{keyPath:"id",autoIncrement:!0});i.indexNames.contains("id")||i.createIndex("id","id",{unique:!0}),i.indexNames.contains(t)||i.createIndex(t,t,{unique:o.unique})}})}},{key:"deleteColumn",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new TypeError("需要一个字符串类型的索引名");this.closeDB();var n=this.version+1;return new Promise(function(a,o){var i=r.open(t.databaseName,n);i.onsuccess=function(){t.setDB(i.result),t.database.isOpen=!0,a(t.database)},i.onerror=function(e){t.database=i.result,t.version=i.result.version,t.database.close(),o(e.target.error)},i.onupgradeneeded=function(n){var r=n.target.result,a=n.target.transaction;t.database=r,t.version=t.database.version;var o=a&&a.objectStoreNames.contains(t.name)?a.objectStore(t.name):r.createObjectStore(t.name,{keyPath:"id",autoIncrement:!0});o.indexNames.contains("id")||o.createIndex("id","id",{unique:!0}),o.indexNames.contains(e)&&o.deleteIndex(e)}})}},{key:"addColumns",value:function(t){var n=this;if(!(t&&t instanceof Array))throw new TypeError("列名组应该是一个数组");var a=[];t.forEach(function(t){var n=void 0===t?"undefined":e(t);if("string"===n)a.push({index:t,unique:!1});else{if("object"!==n)throw new TypeError("索引列格式错误");a.push({index:t.index,unique:t.unique})}}),this.closeDB();var o=this.version+1;return new Promise(function(e,t){var i=r.open(n.databaseName,o);i.onsuccess=function(){n.setDB(i.result),n.database.isOpen=!0,e(n.database)},i.onerror=function(e){n.database=i.result,n.version=i.result.version,n.database.close(),t(e.target.error)},i.onupgradeneeded=function(e){var t=e.target.result,r=e.target.transaction;n.database=t,n.version=n.database.version;var o=r&&r.objectStoreNames.contains(n.name)?r.objectStore(n.name):t.createObjectStore(n.name,{keyPath:"id",autoIncrement:!0});o.indexNames.contains("id")||o.createIndex("id","id",{unique:!0}),a.forEach(function(e){o.indexNames.contains(e.index)||o.createIndex(e.index,e.index,{unique:e.unique})}),n.database=t}})}},{key:"deleteColumns",value:function(e){var t=this;if(!(e&&e instanceof Array))throw new TypeError("需要一个包含索引名的数组");e.forEach(function(e){if(!e||"string"!=typeof e)throw new TypeError("索引名不是字符串类型")}),this.closeDB();var n=this.version+1;return new Promise(function(a,o){var i=r.open(t.databaseName,n);i.onsuccess=function(){t.setDB(i.result),t.database.isOpen=!0,a(t.database)},i.onerror=function(e){t.database=i.result,t.version=i.result.version,t.database.close(),o(e.target.error)},i.onupgradeneeded=function(n){var r=n.target.result,a=n.target.transaction;t.database=r,t.version=t.database.version;var o=a&&a.objectStoreNames.contains(t.name)?a.objectStore(t.name):r.createObjectStore(t.name,{keyPath:"id",autoIncrement:!0});o.indexNames.contains("id")||o.createIndex("id","id",{unique:!0}),e.forEach(function(e){o.indexNames.contains(e)&&o.deleteIndex(e)})}})}},{key:"deleteItem",value:function(e){if(!Number.isSafeInteger(e))throw new TypeError("参数只能是目标数据的id属性值");if(!this.isReady())throw new Error("数据库尚未准备好");var t=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(n,r){var a=t.delete(e);a.onsuccess=function(){n(a.result)},a.onerror=function(e){r(e.target.error)}})}},{key:"deleteItems",value:function(e){var t=this;if(!(e instanceof Array)||0===e.length)throw new TypeError("参数只能是目标数据的id属性值组成的数组且不能为空");e.forEach(function(e){if(!Number.isSafeInteger(e))throw new TypeError("id属性值应是整数")});var n=this.ready();return e.forEach(function(e){n=n.then(function(){return t.deleteItem(e)})}),n}},{key:"delete",value:function(e){var t=Number.isSafeInteger(e),n=e instanceof Array;if(!t&&!n)throw new TypeError("参数只能是目标数据的id属性值或由id组成的数组");var r=void 0;return t?r=this.deleteItem(e):n&&(r=this.deleteItems(e)),r}},{key:"setItem",value:function(t){if(!t||"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("参数只能是一个对象");if(void 0!==t.id&&!Number.isSafeInteger(t.id))throw new TypeError("参数的id属性只能为整数");if(!this.isReady())throw new Error("数据库尚未准备好");var n=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(e,r){var a=n.put(t);a.onsuccess=function(){e(a.result)},a.onerror=function(e){r(e.target.error)}})}},{key:"setItems",value:function(t){var n=this;if(!(t&&t instanceof Array))throw new TypeError("参数应是一个数组");if(t.forEach(function(t){if(!t||"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("参数只能是一个对象")}),!this.isReady())throw new Error("数据库尚未准备好");var r=this.ready();return t.forEach(function(e){r=r.then(function(){return n.setItem(e)})}),r}},{key:"set",value:function(t){var n=t instanceof Array,r="object"===(void 0===t?"undefined":e(t));if(!r&&!n)throw new TypeError("参数只能是目标数据的id属性值或由id组成的数组");var a=void 0;return n?a=this.setItems(t):r&&(a=this.setItem(t)),a}},{key:"getItem",value:function(e){if(!Number.isSafeInteger(e))throw new TypeError("参数只能是目标数据的id属性值");if(!this.isReady())throw new Error("数据库尚未准备好");var t=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(n,r){var a=t.get(e);a.onsuccess=function(){n(a.result)},a.onerror=function(e){r(e.target.error)}})}},{key:"getItems",value:function(e){if(!(e instanceof Array)||0===e.length)throw new TypeError("参数只能是目标数据的id属性值组成的数组且不能为空");e.forEach(function(e){if(!Number.isSafeInteger(e))throw new TypeError("id属性值应是整数")});var t=e.sort(),n=o.bound(t[0],t[t.length-1]);if(!this.isReady())throw new Error("数据库尚未准备好");var r=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(e,t){var a=r.getAll(n);a.onsuccess=function(){e(a.result)},a.onerror=function(e){t(e.target.error)}}).then(function(e){var n=[];return e.forEach(function(e){t.includes(e.id)&&n.push(e)}),n})}},{key:"get",value:function(e){var t=Number.isSafeInteger(e),n=e instanceof Array;if(!t&&!n)throw new TypeError("参数只能是目标数据的id属性值或由id组成的数组");var r=void 0;return t?r=this.getItem(e):n&&(r=this.getItems(e)),r}},{key:"getAll",value:function(e){var t=e||"id";if("string"!=typeof t)throw new TypeError("索引名只能是字符串");if(!this.isReady())throw new Error("数据库尚未准备好");var n=this.database.transaction(this.name,"readwrite").objectStore(this.name).index(t);return new Promise(function(e,t){var r=n.getAll();r.onsuccess=function(){e(r.result)},r.onerror=function(e){t(e.target.error)}})}},{key:"findItems",value:function(t){if(!t||"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("参数应该是一个对象");if(!this.isReady())throw new Error("数据库尚未准备好");var n=this.database.transaction(this.name,"readwrite").objectStore(this.name),r=Object.keys(t),a=n.index(r[0]),i=o.only(t[r[0]]);return new Promise(function(e,t){var n=a.getAll(i);n.onsuccess=function(){e(n.result)},n.onerror=function(e){t(e.target.error)}}).then(function(e){var n=[];return e.forEach(function(e){var a=1;r.forEach(function(n){e[n]!==t[n]&&(a=0)}),a&&n.push(e)}),n})}}],[{key:"openDB",value:function(e){if(!e||"string"!=typeof e)throw new TypeError("数据库名不能为"+e);return new Promise(function(t,n){var a=r.open(e);a.onsuccess=function(){var e=a.result;e.isOpen=!0,e.onclose=function(){e.isOpen=!1},t(e)},a.onerror=function(e){return n(e.target.error)}})}}]),i}();exports.default=i;
},{}],6:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=void 0,t=require("./store"),n=r(t);function r(e){return e&&e.__esModule?e:{default:e}}var i=new n.default("Missions");i.create=function(e){return i.set(e)},i.save=function(e){return i.set(e)},i.init=function(){return 1===i.init?e:(i.init=1,i.ready().then(function(){return i.addColumns(["date","content"])}))},i.init(),exports.default=i;
},{"./store":8}],4:[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),t=require("./indexeddb/missions"),n=r(t);function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(e){return e instanceof KeyboardEvent&&13===e.keyCode},a=function(e){return e&&1===e.nodeType},d=function(e){return e&&"string"==typeof e},s=function(e){return!!a(e)&&e.parentNode},u=function(e){if(!a(e))return!1;for(var t=[],n=e,r=0;r<999&&(n=s(n),a(n));r+=1)t.push(n);return t},l={i:0,getIndex:function(){return l.i+=1,l.i}},f=function(){function t(e){if(i(this,t),"string"==typeof e){var n=e.match(/^<(.+)>$/);if(!n)return document.querySelectorAll(e);var r=n[1].toLocaleUpperCase();this.dom=document.createElement(r)}else if(e instanceof t)this.dom=e.dom;else{if(!a(e))throw console.warn(e),new TypeError("无效参数");this.dom=e}return this}return e(t,[{key:"attr",value:function(e,t){if(!e||!d(e))throw new TypeError("没有key参数");var n=this;return void 0!==t?this.dom.setAttribute(e,""+t):n=this.dom.getAttribute(e),n}},{key:"addClass",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");return e.split(" ").forEach(function(e){return t.dom.classList.add(e)}),this}},{key:"removeClass",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");return e.split(" ").forEach(function(e){return t.dom.classList.remove(e)}),this}},{key:"append",value:function(e){var n=e instanceof t?e.dom:e;if(!n||1!==n.nodeType)throw new TypeError("参数不是html元素");return this.dom.appendChild(n),this}},{key:"remove",value:function(e){if(e){if(a(e))this.dom.removeChild(e);else if(d(e)){var t=this.dom.querySelector(e);this.dom.removeChild(t)}}else this.dom.remove();return this}},{key:"text",value:function(e){return this.dom.innerText=e,this}},{key:"html",value:function(e){return this.dom.innerHTML=e,this}},{key:"find",value:function(e){return this.dom.querySelector(e)}},{key:"children",value:function(e){return this.dom.querySelectorAll(e)}},{key:"parent",value:function(){var e=this.dom.parentNode;return e&&1===e.nodeType?e:void 0}},{key:"parents",value:function(e){var t=u(this.dom),n=[];e&&d(e)?document.querySelectorAll(e).forEach(function(e){t.includes(e)&&n.push(e)}):n=t;return n}},{key:"on",value:function(e,t){return this.dom.addEventListener(e,t),this}},{key:"off",value:function(e,t){return this.dom.removeEventListener(e,t),this}}],[{key:"of",value:function(e){return new t(e)}}]),t}(),m=f.of;window.$=m;var c=function(){function t(){i(this,t)}return e(t,null,[{key:"createDialogElement",value:function(){var e=m("body")[0];if(!e.dom)throw new ReferenceError("页面主体没有加载完");var t=m("<div>").addClass("dialog"),n=m("<div>").addClass("curtain"),r=m("<div>").addClass("alert"),i=m("<div>").addClass("msg"),o=m("<div>").addClass("alert-buttons"),a=m("<button>").text("确定");return a.on("click",function(){e.remove(t)}),o.append(a),r.append(i).append(o),t.append(n).append(r),t.dom}},{key:"alert",value:function(e){if(!e||"string"!=typeof e)throw new TypeError("参数只能是字符串");var n=m("body")[0];if(!n.dom)throw new ReferenceError("页面主体没有加载完");var r=t.createDialogElement(),i=r.querySelector(".msg");if(!i)throw new ReferenceError("dialog不完整");return i.innerText=e,n.append(r)}}]),t}(),h=function(){function t(){if(i(this,t),this.element=document.querySelector("#mission"),this.listElement=document.querySelector("#mission-list"),this.formElement=document.querySelector("#mission-form"),this.adderElement=document.querySelector("#add-mission"),!(this.element&&this.listElement&&this.formElement&&this.adderElement))throw new ReferenceError("界面元素不完整");return this.init(),this.loadDB(),this}return e(t,[{key:"loadDB",value:function(){var e=this;return n.default.ready().then(function(){return n.default.getAll()}).then(function(n){n.forEach(function(n){var r=t.createMissionItem(n.content,n.date,n.id);m(e.listElement).append(r)})}),this}},{key:"init",value:function(){var e=this;if(1===this.init)return!1;var t=m(this.adderElement).find("*[name=open-form]");m(t).on("click",function(){m(e.adderElement).parent().insertBefore(e.formElement,e.adderElement),m(e.formElement).find("input[name=content]").value="",m(e.formElement).find("input[name=date]").value="",m(e.formElement).attr("data-item-id","").removeClass("hide")});var n=m(this.formElement).find("button[name=submit]");m(n).on("click",function(){m(e.formElement).attr("data-item-id")?e.updateMission():e.createMission()}),m(this.formElement).children("input").forEach(function(e){m(e).on("keypress",function(e){o(e)&&n.click()})});var r=m(this.formElement).find("*[name=hide-form]");return m(r).on("click",function(){m(e.formElement).addClass("hide")}),m(this.listElement).children("*[name=finish]").forEach(function(e){m(e).on("click",function(){var t=m(e).parents(".mission-item")[0];m(t).remove()})}),this.init=1,this}},{key:"createMission",value:function(){var e=this,r=this.formElement,i=m(r).find("input[name=content]");if(!i.value)return!1;var o=m(r).find("input[type=date]"),a={content:i.value,date:o.value};return n.default.create(a).then(function(n){var r=t.createMissionItem(i.value,o.value,n);i.value="",o.value="",m(e.listElement).append(r)}),m(this.formElement).attr("data-item-id",""),this}},{key:"updateMission",value:function(){var e=this,t=m(this.formElement).attr("data-item-id");if(!t)return!1;var r=m("#"+t)[0];if(!r)throw new ReferenceError("找不到#"+t+"元素");var i=m(this.formElement).find("input[name=content]"),o=m(this.formElement).find("input[name=date]"),a=i.value,d=o.value,s={id:Number(t.match(/^item-(\d+)$/)[1]),content:a,date:d};return n.default.save(s).then(function(){m(r).find("*[name=content]").innerText=a,m(r).find("*[name=date]").innerText=d,m(r).removeClass("hide"),i.value="",o.value="",m(e.formElement).addClass("hide")}),this}}],[{key:"isElementComplete",value:function(){var e=document.querySelector("#mission"),t=document.querySelector("#mission-list"),n=document.querySelector("#mission-form"),r=document.querySelector("#add-mission");return e&&t&&n&&r}},{key:"transformItem",value:function(e){if(!a(e)||!e.classList.contains("mission-item"))throw new TypeError("不是任务列表的子元素");var t=m(e).parent(),n=e.nextSibling,r=m("#mission-form")[0],i=m(e).find("*[name=content]").innerText,o=m(e).find("*[name=date]").innerText;return t.querySelectorAll(".mission-item").forEach(function(t){t.id!==e.id&&m(t).removeClass("hide")}),m(e).addClass("hide"),t.insertBefore(r,n),m(r).removeClass("hide").attr("data-item-id",e.id),m(r).find("input[name=content]").value=i,m(r).find("input[name=date]").value=o,r}},{key:"createMissionItem",value:function(e,r,i){if(!t.isElementComplete())throw new ReferenceError("界面元素不完整");var o=m("<li>").addClass("mission-item").attr("id","item-"+i).attr("draggable","true"),a=m("<div>").addClass("item-before"),d=m("<i>").addClass("fa fa-arrows"),s=m("<div>").addClass("item-left"),u=m("<div>").addClass("item-right"),l=m("<i>").addClass("fa fa-circle-o item-icon fa-lg").attr("name","finish"),f=m("<span>").attr("name","content").text(e),c=m("<span>").attr("name","date").addClass("text-sm-center").text(r),h=m("<a>").append(l);return window.link=h,f.on("click",function(){t.transformItem(o.dom)}),h.on("click",function(){n.default.ready().then(function(){return n.default.delete(i)}).then(function(){return o.remove()})}),d.on("click",function(){console.log('这里要改成keydown draggable="true" keyup draggable="false"')}),o.on("dragstart",function(e){var t=o.parent();m(t).attr("drag",o.dom.id),e.dataTransfer.setData("Text",o.dom.id),o.addClass("item-curtain")}),o.on("dragover",function(e){e.preventDefault();var t=o.parent(),n=o.dom.nextSibling,r=m(t).attr("drag"),i=m(t).find("#"+r),a=i.nextSibling;t.insertBefore(o.dom,a),t.insertBefore(i,n)}),o.on("drop",function(e){e.preventDefault();var t=o.parent(),n=o.dom.nextSibling,r=e.dataTransfer.getData("Text"),i=m(t).find("#"+r),a=i.nextSibling;t.insertBefore(o.dom,a),t.insertBefore(i,n),o.removeClass("item-curtain")}),a.append(d),s.append(h).append(f),u.append(c),o.append(a).append(s).append(u),o.dom}},{key:"getElement",value:function(){return document.querySelector("#mission")}}]),t}();document.addEventListener("DOMContentLoaded",function(){var e=new h;window.mission=e});
},{"./indexeddb/missions":6}]},{},[4], null)
//# sourceMappingURL=/scripts.3c8b4f40.map