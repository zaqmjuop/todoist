parcelRequire=function(e,r,n,t){function i(n,t){function o(e){return i(o.resolve(e))}function c(r){return e[n][1][r]||r}if(!r[n]){if(!e[n]){var l="function"==typeof parcelRequire&&parcelRequire;if(!t&&l)return l(n,!0);if(u)return u(n,!0);if(f&&"string"==typeof n)return f(n);var p=new Error("Cannot find module '"+n+"'");throw p.code="MODULE_NOT_FOUND",p}o.resolve=c;var a=r[n]=new i.Module(n);e[n][0].call(a.exports,o,a,a.exports,this)}return r[n].exports}function o(e){this.id=e,this.bundle=i,this.exports={}}var u="function"==typeof parcelRequire&&parcelRequire,f="function"==typeof require&&require;i.isParcelRequire=!0,i.Module=o,i.modules=e,i.cache=r,i.parent=u;for(var c=0;c<n.length;c++)i(n[c]);if(n.length){var l=i(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):t&&(this[t]=l)}return i}({6:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(e){return"string"==typeof e},n=function(e){return!(!e||!r(e))},o=function(e){if(!n(e))throw new TypeError("参数classes不能为 "+e);return e.replace(/\s+/g," ").split(" ")},i=0,a=function(){function r(e){if(t(this,r),!e)throw new TypeError("参数无效");if(e instanceof r)this.dom=e.dom;else if(e instanceof HTMLElement)this.dom=e;else if(n(e)){var o=e.match(/^<(.+)>$/);this.dom=o?document.createElement(o[1]):document.querySelector(e)}return this}return e(r,[{key:"attr",value:function(e,t){if(!n(e))throw new TypeError("参数key不能为 "+e);var r=this;return arguments.length>1&&(e.toLocaleLowerCase().match(/^text$/)?this.dom.innerText=String(t):e.toLocaleLowerCase().match(/^html$/)?this.dom.innerHTML=String(t):"INPUT"===this.dom.tagName&&"value"===e?this.dom.value=String(t):this.dom.setAttribute(e,t)),arguments.length<=1&&(r=e.toLocaleLowerCase().match(/^text$/)?this.dom.innerText:e.toLocaleLowerCase().match(/^html$/)?this.dom.innerHTML:"INPUT"===this.dom.tagName&&"value"===e?this.dom.value:this.dom.getAttribute(e)),r}},{key:"addClass",value:function(e){var t=this;return o(e).forEach(function(e){t.dom.classList.contains(e)||t.dom.classList.add(e)}),this}},{key:"removeClass",value:function(e){var t=this;return o(e).forEach(function(e){t.dom.classList.contains(e)&&t.dom.classList.remove(e)}),this}},{key:"hasClass",value:function(e){var t=this,r=!0;return o(e).forEach(function(e){t.dom.classList.contains(e)||(r=!1)}),r}},{key:"toggleClass",value:function(e){return this.hasClass(e)?this.removeClass(e):this.addClass(e),this}},{key:"append",value:function(e){var t=this;return(n(e)?document.querySelectorAll(e):[r.degenerate(e)]).forEach(function(e){t.dom.appendChild(e)}),this}},{key:"replace",value:function(e){if(!r.isElement(e))throw new TypeError(e+"不是HTMLElement");var t=this.dom.parentElement;return t&&t.replaceChild(e,this.dom),e}},{key:"insertBefore",value:function(e){if(!r.isElement(e))throw new TypeError(e+"不是HTMLElement");var t=e.parentElement;return t&&t.insertBefore(this.dom,e),e}},{key:"insertAfter",value:function(e){if(!r.isElement(e))throw new TypeError(e+"不是HTMLElement");var t=e.parentElement;if(t){var n=e.nextElementSibling;n?t.insertBefore(this.dom,n):t.appendChild(this.dom)}return e}},{key:"selfDestruct",value:function(){if(!this.dom)return!1;var e=this.dom.parentElement;return!!e&&(e.removeChild(this.dom),this)}},{key:"remove",value:function(e){var t=this;return 0===arguments.length?this.selfDestruct():((n(e)?this.dom.querySelectorAll(e):[r.degenerate(e)]).forEach(function(e){t.dom.removeChild(e)}),this)}},{key:"text",value:function(e){var t=void 0;return void 0!==e?(this.dom.innerText=String(e),t=this):t=this.dom.innerText,t}},{key:"html",value:function(e){var t=void 0;return void 0!==e?(this.dom.innerHTML=String(e),t=this):t=this.dom.innerHTML,t}},{key:"child",value:function(e){return n(e)?this.dom.querySelector(e):r.degenerate(e)}},{key:"children",value:function(e){var t=void 0;if(void 0===e)t=this.dom.children();else{if(!n(e))throw new TypeError("selector不能为"+e);t=this.dom.querySelectorAll(e)}return t}},{key:"parent",value:function(e){return r.getParent(this.dom,e)}},{key:"parents",value:function(e){return r.getParents(this.dom,e)}},{key:"hasParent",value:function(e){return r.hasParent(this.dom,e)}},{key:"on",value:function(e,t){if(!n(e))throw new TypeError("event不能是"+e);if("function"!=typeof t)throw new TypeError("callback不能是"+t);return this.dom.addEventListener(e,t),this}},{key:"off",value:function(e,t){if(!n(e))throw new TypeError("event不能是"+e);if("function"!=typeof t)throw new TypeError("callback不能是"+t);return this.dom.removeEventListener(e,t),this}},{key:"clear",value:function(e){if(!n(e))throw new TypeError("event不能是"+e);return this.dom["on"+e]=void 0,this}}],[{key:"all",value:function(e){return document.querySelectorAll(e)}},{key:"of",value:function(e){return new r(e)}},{key:"degenerate",value:function(e){var t=void 0;if(e instanceof r)t=e.dom;else if(e instanceof HTMLElement)t=e;else{if(!n(e))throw new TypeError("参数query不能是"+e);t=document.querySelector(e)}return t}},{key:"isElement",value:function(e){return e&&e instanceof HTMLElement&&1===e.nodeType}},{key:"getParentsTree",value:function(e){if(!r.isElement(e))throw new TypeError("element不能是"+e);for(var t=[],n=e;n.parentElement;)n=n.parentElement,t.push(n);return t}},{key:"getParent",value:function(e,t){if(!r.isElement(e))throw new TypeError("element不能是"+e);var o=void 0,i=r.getParentsTree(e),a=document.querySelectorAll(t);if(void 0===t)o=e.parentElement;else{var s=void 0;if(n(t))s=i;else if(t instanceof r)s=[t.dom];else{if(!(t instanceof HTMLElement))throw new TypeError("query不能是"+t);s=[t]}s.forEach(function(e){a.forEach(function(t){t.isSameNode(e)&&(o=e)})})}return o}},{key:"getParents",value:function(e,t){if(!r.isElement(e))throw new TypeError("element不能是"+e);var o=void 0,i=r.getParentsTree(e),a=document.querySelectorAll(t);if(void 0===t)o=i;else{if(o=[],!n(t))throw new TypeError("query不能是"+t);i.forEach(function(e){a.forEach(function(t){t.isSameNode(e)&&o.push(e)})})}return o}},{key:"hasParent",value:function(e,t){if(!r.isElement(e))throw new TypeError("element不能是"+e);if(arguments.length<2)throw new Error("缺少参数");var o=void 0,i=void 0,a=r.getParentsTree(e);if(n(t)){var s=document.createElement("div"),l=a.map(function(e){var t=e.cloneNode();return s.appendChild(t),t}),u=s.querySelector(t);if(u)o=a[l.indexOf(u)]}return n(t)||(t instanceof HTMLElement?i=t:t instanceof r&&(i=t.dom),o=a.find(function(e){return e.isSameNode(i)})),o}},{key:"globalInit",value:function(){return!i&&(i+=1,HTMLCollection.prototype.forEach=Array.prototype.forEach,i)}}]),r}();a.globalInit(),exports.default=a;
},{}],7:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=function(n){return n instanceof KeyboardEvent&&13===n.keyCode},t=function(n){return n&&1===n.nodeType},e=function(n){return n&&"string"==typeof n},r=function(n){return n&&"function"==typeof n},i=function(n){var t=null===n||void 0===n||!1===n||n===[]||n==={},e=!String(n).match(/\S/);return t||e};exports.default={isElement:t,isKeyEnter:n,isString:e,isFunction:r,isEmptyString:i};
},{}],8:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./utils"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var n={get:function(e,t){if("string"!=typeof e)throw new TypeError("路径错误");if(!(t instanceof Function))throw new TypeError("回调函数错误");var r=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");r.open("GET",e,!0),r.send(),r.onreadystatechange=function(e){return 4===r.readyState&&200===r.status&&t(e)}}},o={get:function(e){if(!t.default.isString(e))throw new TypeError("参数url是路径 字符串类型");return new Promise(function(t){n.get(e,function(e){t(e.target.response)})})}};exports.default=o;
},{"./utils":7}],4:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=require("../dom"),r=l(n),a=require("../utils"),o=l(a),i=require("../ajax"),u=l(i);function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=function(e){function n(){return c(this,n),s(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return f(n,Array),t(n,[{key:"findById",value:function(e){var t=String(e).match(/\d+/)[0];if(t){var n=Number(t);return this.find(function(e){return e.componentId&&e.componentId===n})}}}]),n}(),p=new d,h=100001,m=function(){return h+=1},y=function(){function n(t){var a=this;if(c(this,n),"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("param应该是一个object");if(!o.default.isElement(t.template))throw new TypeError("param.template应该是一个HtmlElement");var i=Object.assign(this,t);o.default.isString(this.query)&&r.default.of(this.template).attr("data-c-query",this.query);var u=r.default.of(i.query).dom||r.default.of("*[data-c-query="+i.query+"]").dom;if(!u)throw new TypeError("选择器 "+i.query+" 未找到匹配项");if(i.query=u,i.elements={},i.selectors&&"object"===e(i.selectors)){var l={};Object.keys(i.selectors).forEach(function(e){var t=i.selectors[e];if(t&&o.default.isString(t)){var n=i.template.querySelector(t);o.default.isElement(n)&&(l[e]=n)}}),Object.keys(l).length>0&&(l.template=i.template,i.elements=l)}if(i.present=i.present||{},!(i.data instanceof Function))throw new TypeError("缺少data属性或data不是Function类型");var s=i.data();if(i.data=Object.assign({},s),s instanceof Array||"object"!==(void 0===s?"undefined":e(s)))throw new TypeError("data应该返回一个Object");if(Object.keys(i.data).some(function(e){return i.data[e]instanceof Function}))throw new TypeError("data返回的Object中不能含有Function");if(i.watch instanceof Function){var f=i.watch();if(f instanceof Object&&!(f instanceof Array)){var h=Object.keys(f),m=Object.keys(s);h.filter(function(e){return m.includes(e)}).forEach(function(e){Object.defineProperty(i.data,e,{enumerable:!0,get:function(){return s[e]},set:function(t){s[e]=t,f[e]()}})})}}i.setComponentId();var y=Object.assign({},i.methods);return Object.keys(y).forEach(function(e){var t=y[e];t&&"function"==typeof t&&(y[e]=t.bind(i))}),i.methods=y,i.components=new d,p.push(i),this.formatChildren().then(function(){return a.lifeCycle()}),i}return t(n,[{key:"formatChildren",value:function(){var e=this;if(!this.children)return new Promise(function(e){return e(!1)});this.children=Object.assign({},this.children);var t=Object.keys(this.elements),r=new Promise(function(e){return e(1)});return Object.keys(this.children).forEach(function(a){var o=e.children[a];r=r.then(function(){return o instanceof n?o:e.appendComponent(o)}).then(function(n){e.children[a]!==n&&(e.children[a]=n);var r=t.find(function(t){return e.elements[t]===n.query});r&&(e.elements[r]=n.template)})}),r}},{key:"lifeCycle",value:function(){o.default.isFunction(this.created)&&this.created(),this.implant(),o.default.isFunction(this.implanted)&&this.implanted()}},{key:"refresh",value:function(e){e&&(this.present=e),o.default.isFunction(this.created)&&this.created(),o.default.isFunction(this.implanted)&&this.implanted()}},{key:"addEventListener",value:function(e,t){this.template.addEventListener(e,t)}},{key:"dispatchEvent",value:function(e,t){var n=new CustomEvent(e,{detail:t});this.template.dispatchEvent(n)}},{key:"setComponentId",value:function(){var e=this;this.componentId=String(m()),this.template.setAttribute("data-c-id","c"+this.componentId),this.style.setAttribute("data-c-id","c"+this.componentId);return function t(n){return n instanceof HTMLElement&&!(n.childElementCount<1)&&(n.children.forEach(function(n){n.setAttribute("data-c-id","c"+e.componentId),t(n)}),n)}(this.template),this}},{key:"replaceGeneralScopedStyles",value:function(e){var t=this,n=e.match(/[#\u002e\u002aA-Za-z][^{}]*{([^{}]*{[^{}]*})*[^{}]*}/g);return n.forEach(function(e,r){var a=t.replaceGeneralScopedStyle(e);n[r]=a}),n.join(" ")}},{key:"replaceGeneralScopedStyle",value:function(e){var t=this,n=e.replace(/\s*{.*$/,"").replace(/^\s*/,"").split(",");n.forEach(function(e,r){var a=e.replace(/[#\u002a\u002eA-Za-z][^\s+~>{]*/g,function(e){return e.replace(/([#\u002a\u002eA-Za-z][^:]*)/,function(e){return e+"[data-c-id=c"+t.componentId+"]"})});n[r]=a});var r=n.join(",");return e.replace(/^[^{}]*{/,function(){return r+" {"})}},{key:"handleScopedStyle",value:function(){var e=this;if(!(this.style.getAttribute("scoped")||""===this.style.getAttribute("scoped")))return!1;var t=this.style.innerHTML.replace(/\n/g,"").replace(/\s+/g," ").match(/(@keyframes|@media|[#\u002e\u002aA-Za-z])[^{}]*{([^{}]*{[^{}]*})*[^{}]*}/g);if(!t)return!1;t.forEach(function(n,r){var a=void 0;if(n.match("@keyframes"))a=n;else if(n.match("@media")){var o=n.replace(/^[^@]*@media[^{]*{/,"").replace(/}[^}]*$/,"");a=e.replaceGeneralScopedStyles(o)}else a=e.replaceGeneralScopedStyle(n);t[r]=a});var n=t.join(" ");return this.style.innerHTML=n,this}},{key:"implant",value:function(){var e=this.style.getAttribute("scoped")||""===this.style.getAttribute("scoped");if(r.default.of(this.query).replace(this.template),this.style){e&&this.handleScopedStyle();var t=document.querySelector("style[data-c-id=c"+this.componentId+"]");t?document.querySelector("head").replaceChild(this.style,t):document.querySelector("head").appendChild(this.style)}return this}},{key:"replaceElement",value:function(e){if(!r.default.isElement(e))throw new TypeError(e+"不是HTMLElement");r.default.of(e).replace(this.template),this.refresh()}},{key:"insertComponent",value:function(e,t,a){var o=this;if(!r.default.of(t).hasParent(this.template))throw new Error(t,"不是",this,"的子元素");var i=Number(a);if(!Number.isSafeInteger(i))throw new Error(a+"不是有效数字");var u=t.parentElement,l=Array.from(u.children).indexOf(t),c=r.default.of("<div>").dom;if(r.default.of(c).attr("data-c-id","c"+this.componentId),0===i)r.default.of(t).replace(c);else if(i>0){var s=-1+l+i,f=u.children[s]||t;r.default.of(c).insertAfter(f)}else{var d=1+l+i,p=u.children[d]||t;r.default.of(c).insertBefore(p)}var h=void 0;if(e instanceof n)h=new Promise(function(t){e.query=c,o.components.push(e),t(e)});else{var m=Object.assign({},e);h=n.pjaxFormatHtml(e.url).then(function(e){var t=e.template,r=e.style;m.template=t,m.style=r,m.query=c;var a=n.of(m);return o.components.push(a),a})}return h}},{key:"appendChildComponent",value:function(e,t){var a=this;if(!t.isSameNode(this.template)&&!r.default.of(t).hasParent(this.template))throw new Error(t+"不属于此组件");var o=r.default.of("<placeholder>");r.default.of(o).attr("data-c-id","c"+this.componentId),r.default.of(t).append(o);var i=void 0;if(e instanceof n)i=new Promise(function(t){e.query=o,a.components.push(e),t(e)});else{var u=Object.assign({},e);i=n.pjaxFormatHtml(e.url).then(function(e){var t=e.template,r=e.style;u.template=t,u.style=r,u.query=o;var i=n.of(u);return a.components.push(i),i})}return i}},{key:"appendComponent",value:function(e){var t=this,r=Object.assign({},e);if(!o.default.isString(e.url))throw new TypeError("param.url应该是字符串类型html文件地址");return n.pjaxFormatHtml(e.url).then(function(e){var a=e.template,o=e.style;r.template=a,r.style=o,r.query=t.template.querySelector(r.query);var i=n.of(r);return t.components.push(i),i})}},{key:"replaceSelf",value:function(e){var t=this,a=void 0;if(e instanceof n)a=new Promise(function(n){r.default.of(t.template).replace(e.template),r.default.of(t.style).replace(e.style),e.refresh(),n(e)});else{if(!o.default.isString(e.url))throw new TypeError("param.url应该是字符串类型html文件地址");a=n.pjaxFormatHtml(e.url).then(function(a){var o=a.template,i=a.style;r.default.of(t.style).remove();var u=Object.assign(e,{template:o,style:i});return u.query=t.template,n.of(u)})}return a}}],[{key:"find",value:function(e){var t=Number(e);return p.filter(function(e){return Number(e.componentId)===t})[0]}},{key:"destroy",value:function(e){var t=void 0;if(t=e instanceof n?e:n.find(e))for(var a=0;a<3;a+=1){r.default.of("*[data-c-id=c"+t.componentId+"]").remove()}t.children&&Object.keys(t.children).forEach(function(e){var r=t.children[e];n.destroy(r)});return t.components&&t.components.forEach(function(e){n.destroy(e)}),t}},{key:"pjaxFormatHtml",value:function(e){return u.default.get(e).then(function(e){var t=document.createElement("html");t.innerHTML=e;var n=t.querySelectorAll("style"),r=t.querySelector("body");if(n.length>1)throw new TypeError("至多可以有一个<style>元素");if(1!==r.childElementCount)throw new TypeError("<body>内应有且只有一个根元素");return{template:r.firstElementChild,style:n[0]}})}},{key:"of",value:function(e){return new n(e)}},{key:"pjaxCreate",value:function(e){if(!o.default.isString(e.url))throw new TypeError("param.url应该是字符串类型html文件地址");return n.pjaxFormatHtml(e.url).then(function(t){var r=Object.assign(e,t);return n.of(r)})}},{key:"all",value:function(){return p}}]),n}();window.Component=y,exports.default=y;
},{"../dom":6,"../utils":7,"../ajax":8}],17:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,a=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,o=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,i=function(){function i(e){if(n(this,i),!r||!a||!o)throw new Error("您的浏览器不支持indexedDB");return this.name=this.name||e,this.databaseName="myEncapsulation",this}return t(i,[{key:"setDB",value:function(e){var t=this;if(!(e&&e instanceof IDBDatabase))throw new TypeError("参数应是数据库对象");return this.database=e,this.version=this.database.version,this.database.onclose=function(){t.database.isOpen=!1},e}},{key:"closeDB",value:function(){this.database&&this.database.isOpen&&(this.database.close(),this.database.isOpen=!1)}},{key:"openDB",value:function(e){var t=this;if(e){if(!Number.isSafeInteger(e))throw new TypeError("版本号只能是整数");if(e<this.version)throw new TypeError("新版本号不能比当前版本号低")}var n=e&&Number.isSafeInteger(e)&&e>this.version?e:this.version;return this.database&&this.closeDB(),new Promise(function(a,o){var i=e&&Number.isSafeInteger(e)&&e>t.version?r.open(t.databaseName,n):r.open(t.databaseName);i.onsuccess=function(){t.setDB(i.result),t.database.isOpen=!0,a(t.database)},i.onerror=function(e){o(e.target.error)},i.onupgradeneeded=function(e){t.setDB(e.target.result);var n=e.target.transaction;n.objectStoreNames.contains(t.name)||(t.database.createObjectStore(t.name,{keyPath:"id",autoIncrement:!0}),n.objectStore(t.name).createIndex("id","id",{unique:!0}))}})}},{key:"ready",value:function(){var e=this;return this.openDB().then(function(t){return e.setDB(t)})}},{key:"isReady",value:function(){return this.database&&this.database instanceof IDBDatabase&&this.database.isOpen}},{key:"addColumn",value:function(t,n){var a=this;if(!t||"string"!=typeof t)throw new TypeError("索引名称必须存在且为字符串");if(n&&"object"!==(void 0===n?"undefined":e(n)))throw new TypeError("索引选项应是对象类型");var o={};o.unique=n&&n.unique;var i=this.version+1;return this.closeDB(),new Promise(function(e,n){var s=r.open(a.databaseName,i);s.onsuccess=function(){a.setDB(s.result),a.database.isOpen=!0,e(a.database)},s.onerror=function(e){n(e.target.error)},s.onupgradeneeded=function(e){var n=e.target.result,r=e.target.transaction;a.database=n,a.version=a.database.version;var i=r&&r.objectStoreNames.contains(a.name)?r.objectStore(a.name):n.createObjectStore(a.name,{keyPath:"id",autoIncrement:!0});i.indexNames.contains("id")||i.createIndex("id","id",{unique:!0}),i.indexNames.contains(t)||i.createIndex(t,t,{unique:o.unique})}})}},{key:"deleteColumn",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new TypeError("需要一个字符串类型的索引名");this.closeDB();var n=this.version+1;return new Promise(function(a,o){var i=r.open(t.databaseName,n);i.onsuccess=function(){t.setDB(i.result),t.database.isOpen=!0,a(t.database)},i.onerror=function(e){t.database=i.result,t.version=i.result.version,t.database.close(),o(e.target.error)},i.onupgradeneeded=function(n){var r=n.target.result,a=n.target.transaction;t.database=r,t.version=t.database.version;var o=a&&a.objectStoreNames.contains(t.name)?a.objectStore(t.name):r.createObjectStore(t.name,{keyPath:"id",autoIncrement:!0});o.indexNames.contains("id")||o.createIndex("id","id",{unique:!0}),o.indexNames.contains(e)&&o.deleteIndex(e)}})}},{key:"addColumns",value:function(t){var n=this;if(!(t&&t instanceof Array))throw new TypeError("列名组应该是一个数组");var a=[];t.forEach(function(t){var n=void 0===t?"undefined":e(t);if("string"===n)a.push({index:t,unique:!1});else{if("object"!==n)throw new TypeError("索引列格式错误");a.push({index:t.index,unique:t.unique})}}),this.closeDB();var o=this.version+1;return new Promise(function(e,t){var i=r.open(n.databaseName,o);i.onsuccess=function(){n.setDB(i.result),n.database.isOpen=!0,e(n.database)},i.onerror=function(e){n.database=i.result,n.version=i.result.version,n.database.close(),t(e.target.error)},i.onupgradeneeded=function(e){var t=e.target.result,r=e.target.transaction;n.database=t,n.version=n.database.version;var o=r&&r.objectStoreNames.contains(n.name)?r.objectStore(n.name):t.createObjectStore(n.name,{keyPath:"id",autoIncrement:!0});o.indexNames.contains("id")||o.createIndex("id","id",{unique:!0}),a.forEach(function(e){o.indexNames.contains(e.index)||o.createIndex(e.index,e.index,{unique:e.unique})}),n.database=t}})}},{key:"deleteColumns",value:function(e){var t=this;if(!(e&&e instanceof Array))throw new TypeError("需要一个包含索引名的数组");e.forEach(function(e){if(!e||"string"!=typeof e)throw new TypeError("索引名不是字符串类型")}),this.closeDB();var n=this.version+1;return new Promise(function(a,o){var i=r.open(t.databaseName,n);i.onsuccess=function(){t.setDB(i.result),t.database.isOpen=!0,a(t.database)},i.onerror=function(e){t.database=i.result,t.version=i.result.version,t.database.close(),o(e.target.error)},i.onupgradeneeded=function(n){var r=n.target.result,a=n.target.transaction;t.database=r,t.version=t.database.version;var o=a&&a.objectStoreNames.contains(t.name)?a.objectStore(t.name):r.createObjectStore(t.name,{keyPath:"id",autoIncrement:!0});o.indexNames.contains("id")||o.createIndex("id","id",{unique:!0}),e.forEach(function(e){o.indexNames.contains(e)&&o.deleteIndex(e)})}})}},{key:"deleteItem",value:function(e){if(!Number.isSafeInteger(e))throw new TypeError("参数只能是目标数据的id属性值");if(!this.isReady())throw new Error("数据库尚未准备好");var t=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(n,r){var a=t.delete(e);a.onsuccess=function(){n(a.result)},a.onerror=function(e){r(e.target.error)}})}},{key:"deleteItems",value:function(e){var t=this;if(!(e instanceof Array)||0===e.length)throw new TypeError("参数只能是目标数据的id属性值组成的数组且不能为空");e.forEach(function(e){if(!Number.isSafeInteger(e))throw new TypeError("id属性值应是整数")});var n=this.ready();return e.forEach(function(e){n=n.then(function(){return t.deleteItem(e)})}),n}},{key:"delete",value:function(e){var t=Number.isSafeInteger(e),n=e instanceof Array;if(!t&&!n)throw new TypeError("参数只能是目标数据的id属性值或由id组成的数组");var r=void 0;return t?r=this.deleteItem(e):n&&(r=this.deleteItems(e)),r}},{key:"setItem",value:function(t){if(!t||"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("参数只能是一个对象");if(void 0!==t.id&&!Number.isSafeInteger(t.id))throw new TypeError("参数的id属性只能为整数");if(!this.isReady())throw new Error("数据库尚未准备好");var n=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(e,r){var a=n.put(t);a.onsuccess=function(){e(a.result)},a.onerror=function(e){r(e.target.error)}})}},{key:"setItems",value:function(t){var n=this;if(!(t&&t instanceof Array))throw new TypeError("参数应是一个数组");if(t.forEach(function(t){if(!t||"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("参数只能是一个对象")}),!this.isReady())throw new Error("数据库尚未准备好");var r=this.ready();return t.forEach(function(e){r=r.then(function(){return n.setItem(e)})}),r}},{key:"set",value:function(t){var n=t instanceof Array,r="object"===(void 0===t?"undefined":e(t));if(!r&&!n)throw new TypeError("参数只能是目标数据的id属性值或由id组成的数组");var a=void 0;return n?a=this.setItems(t):r&&(a=this.setItem(t)),a}},{key:"getItem",value:function(e){if(!Number.isSafeInteger(e))throw new TypeError("参数只能是目标数据的id属性值");if(!this.isReady())throw new Error("数据库尚未准备好");var t=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(n,r){var a=t.get(e);a.onsuccess=function(){n(a.result)},a.onerror=function(e){r(e.target.error)}})}},{key:"getItems",value:function(e){if(!(e instanceof Array)||0===e.length)throw new TypeError("参数只能是目标数据的id属性值组成的数组且不能为空");e.forEach(function(e){if(!Number.isSafeInteger(e))throw new TypeError("id属性值应是整数")});var t=e.sort(),n=o.bound(t[0],t[t.length-1]);if(!this.isReady())throw new Error("数据库尚未准备好");var r=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(e,t){var a=r.getAll(n);a.onsuccess=function(){e(a.result)},a.onerror=function(e){t(e.target.error)}}).then(function(e){var n=[];return e.forEach(function(e){t.includes(e.id)&&n.push(e)}),n})}},{key:"get",value:function(e){var t=Number.isSafeInteger(e),n=e instanceof Array;if(!t&&!n)throw new TypeError("参数只能是目标数据的id属性值或由id组成的数组");var r=void 0;return t?r=this.getItem(e):n&&(r=this.getItems(e)),r}},{key:"getAll",value:function(e){var t=e||"id";if("string"!=typeof t)throw new TypeError("索引名只能是字符串");if(!this.isReady())throw new Error("数据库尚未准备好");var n=this.database.transaction(this.name,"readwrite").objectStore(this.name).index(t);return new Promise(function(e,t){var r=n.getAll();r.onsuccess=function(){e(r.result)},r.onerror=function(e){t(e.target.error)}})}},{key:"findItems",value:function(t){if(!t||"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("参数应该是一个对象");if(!this.isReady())throw new Error("数据库尚未准备好");var n=this.database.transaction(this.name,"readwrite").objectStore(this.name),r=Object.keys(t),a=n.index(r[0]),i=o.only(t[r[0]]);return new Promise(function(e,t){var n=a.getAll(i);n.onsuccess=function(){e(n.result)},n.onerror=function(e){t(e.target.error)}}).then(function(e){var n=[];return e.forEach(function(e){var a=1;r.forEach(function(n){e[n]!==t[n]&&(a=0)}),a&&n.push(e)}),n})}}],[{key:"openDB",value:function(e){if(!e||"string"!=typeof e)throw new TypeError("数据库名不能为"+e);return new Promise(function(t,n){var a=r.open(e);a.onsuccess=function(){var e=a.result;e.isOpen=!0,e.onclose=function(){e.isOpen=!1},t(e)},a.onerror=function(e){return n(e.target.error)}})}}]),i}();exports.default=i;
},{}],12:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./store"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}var n=new t.default("Missions");n.create=function(e){return n.set(e)},n.save=function(e){return n.set(e)};var u=0,o=function(){return u?n:(u=1,n.ready().then(function(){return n.addColumns(["date","content","order"])}))};o(),exports.default=n;
},{"./store":17}],13:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../dom"),e=s(t),n=require("../indexeddb/missions"),i=s(n),a=require("./component"),d=s(a);function s(t){return t&&t.__esModule?t:{default:t}}var r={query:"mission-list-item",url:"./assets/components/missionListItem.html",selectors:{content:".item-content",date:".item-date",done:".done",itemMain:".item-main",counter:"#counter"},data:function(){return{counter:1,inited:0}},methods:{init:function(){return!this.data.inited&&(this.data.inited=1,this.methods.bindEvents(),this)},savePresent:function(){return this.data.content=this.present.content,this.data.date=this.present.date,this.data.id=this.present.id,this.data.formId=this.present.formId,this.data.parentCid=this.present.cid,this},bindEvents:function(){var t=this;e.default.of(this.elements.done).on("click",function(){i.default.ready().then(function(){var e=Number(t.data.id);return i.default.delete(e)}).then(function(){e.default.of(t.template).selfDestruct()})}),e.default.of(this.elements.content).on("click",function(){if(!t.data.formId)return!1;var n={cid:t.componentId,content:t.data.content,date:t.data.date,id:t.data.id,formId:t.data.formId},i=d.default.find(n.formId);i.present=n;var a=e.default.of(i.template).attr("data-cid");if(a){var s=d.default.find(a);s&&i.replaceSelf(s)}return t.replaceSelf(i),t})},fill:function(){e.default.of(this.elements.content).attr("text",this.data.content),e.default.of(this.elements.date).attr("text",this.data.date),e.default.of(this.template).attr("data-item-id",this.data.id)}},created:function(){this.methods.init(),this.methods.savePresent(),this.methods.fill()}};exports.default=r;
},{"../dom":6,"../indexeddb/missions":12,"./component":4}],18:[function(require,module,exports) {
var define;
var e,t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};parcelRequire=function(r,n,o,i){function a(e,t){function o(e){return a(o.resolve(e))}if(!n[e]){if(!r[e]){var i="function"==typeof parcelRequire&&parcelRequire;if(!t&&i)return i(e,!0);if(u)return u(e,!0);if(f&&"string"==typeof e)return f(e);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}o.resolve=function(t){return r[e][1][t]||t};var l=n[e]=new a.Module(e);r[e][0].call(l.exports,o,l,l.exports,this)}return n[e].exports}var u="function"==typeof parcelRequire&&parcelRequire,f="function"==typeof require&&require;a.isParcelRequire=!0,a.Module=function(e){this.id=e,this.bundle=a,this.exports={}},a.modules=r,a.cache=n,a.parent=u;for(var s=0;s<o.length;s++)a(o[s]);if(o.length){var l=a(o[o.length-1]);"object"==("undefined"==typeof exports?"undefined":t(exports))&&"undefined"!=typeof module?module.exports=l:"function"==typeof e&&e.amd&&e(function(){return l})}return a}({3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){return e&&1===e.nodeType},i=function(e){return e&&"string"==typeof e},a=function(e){return!!o(e)&&e.parentNode},u=function(e){if(!o(e))return!1;for(var t=[],r=e,n=0;n<999&&(r=a(r),o(r));n+=1)t.push(r);return t},f=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"==typeof t){var r=t.match(/^<(.+)>$/);if(!r)return document.querySelectorAll(t);var n=r[1].toLocaleUpperCase();this.dom=document.createElement(n)}else if(t instanceof e)this.dom=t.dom;else{if(!o(t)&&t!==document)throw console.warn(t),new TypeError("无效参数");this.dom=t}return this}return n(e,[{key:"attr",value:function(e,t){if(!e||!i(e))throw new TypeError("没有key参数");var r=this;return void 0!==t?this.dom.setAttribute(e,""+t):r=this.dom.getAttribute(e),r}},{key:"addClass",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");return e.split(" ").forEach(function(e){e&&t.dom.classList.add(e)}),this}},{key:"removeClass",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");return e.split(" ").forEach(function(e){e&&t.dom.classList.remove(e)}),this}},{key:"hasClass",value:function(e){if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");if(e.match(" "))throw new TypeError("参数不能含有空格");return this.dom.classList.contains(e)}},{key:"toggleClass",value:function(e){if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");return this.hasClass(e)?this.removeClass(e):this.addClass(e),this}},{key:"append",value:function(t){var r=t instanceof e?t.dom:t;if(!r||1!==r.nodeType)throw new TypeError("参数不是html元素");return this.dom.appendChild(r),this}},{key:"remove",value:function(e){if(e){if(o(e))this.dom.removeChild(e);else if(i(e)){var t=this.dom.querySelector(e);this.dom.removeChild(t)}}else this.dom.remove();return this}},{key:"text",value:function(e){return this.dom.innerText=e,this}},{key:"html",value:function(e){return this.dom.innerHTML=e,this}},{key:"find",value:function(e){return this.dom.querySelector(e)}},{key:"children",value:function(e){return this.dom.querySelectorAll(e)}},{key:"parent",value:function(){var e=this.dom.parentNode;return e&&1===e.nodeType?e:void 0}},{key:"parents",value:function(e){var t=u(this.dom),r=[];return e&&i(e)?document.querySelectorAll(e).forEach(function(e){t.includes(e)&&r.push(e)}):r=t,r}},{key:"on",value:function(e,t){return this.dom.addEventListener(e,t),this}},{key:"off",value:function(e,t){return this.dom.removeEventListener(e,t),this}},{key:"hasParent",value:function(t){if(!e.isElement(t))return!1;var r=!1;return this.parents().forEach(function(e){t.isSameNode(e)&&(r=!0)}),r}}],[{key:"of",value:function(t){return new e(t)}},{key:"isElement",value:function(e){return e&&1===e.nodeType}}]),e}();r.default=f},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=[31,28,31,30,31,30,31,31,30,31,30,31],i=function(e){return Number.isInteger(e)&&e>1900&&e<5001},a=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t&&t instanceof Date))throw new TypeError("参数应是一个Date实例对象");return this.year=t.getFullYear(),this.month=t.getMonth(),this.day=t.getDate(),this}return n(e,[{key:"backOneMonth",value:function(){return this.month-=1,this.month<0&&(this.year-=1,this.month=11),this}},{key:"aheadOneMonth",value:function(){return this.month+=1,this.month>11&&(this.year+=1,this.month=0),this}},{key:"toDate",value:function(){return new Date(this.year,this.month,this.day)}},{key:"reset",value:function(t){var r=e.of(t);if(!r)throw new TypeError("哪里出现了问题");return this.year=r.year,this.month=r.month,this.day=r.day,this}}],[{key:"of",value:function(t){return new e(t)}},{key:"getMonths",value:function(e){if(!i(e))throw new TypeError("参数应该是一个数字，有效值1901-5000");var t=o;return e%4==0&&(t[1]=29),t}},{key:"getDaysCount",value:function(t,r){if(!i(t))throw new TypeError("参数应该是一个数字，有效值1901-5000");if(!function(e){return Number.isInteger(e)&&e>=0&&e<12}(r))throw new TypeError("参数应该是一个数字，有效值0-11");return e.getMonths(t)[r]}},{key:"getWeekArray",value:function(t){if(!(t instanceof Date))throw new TypeError("参数应该是一个Date实例对象");for(var r=[],n=e.getDaysCount(t.getFullYear(),t.getMonth()),o=new Date(t.getFullYear(),t.getMonth()-1,1),i=e.getDaysCount(o.getFullYear(),o.getMonth()),a=t.getDate()-t.getDay(),u=0;u<7;u+=1){var f=a+u;f>n?f-=n:f<1&&(f+=i),r.push(f)}return r}},{key:"getMonthArray",value:function(t){if(!(t&&t instanceof Date))throw new TypeError("参数应该是一个Date实例对象");var r=[],n=e.getDaysCount(t.getFullYear(),t.getMonth()),o=e.getWeekArray(t);r.push(o);for(var i=0;i<5;i+=1){var a=t.getDate()-t.getDay()-1-7*i;if(a>0){var u=new Date(t.getFullYear(),t.getMonth(),a),f=e.getWeekArray(u);r.unshift(f)}var s=t.getDate()-t.getDay()+7+7*i;if(s<=n){var l=new Date(t.getFullYear(),t.getMonth(),s),c=e.getWeekArray(l);r.push(c)}}return r}}]),e}();r.default=a},{}],1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=a(e("./dom")),i=a(e("./customDate"));function a(e){return e&&e.__esModule?e:{default:e}}var u=0,f=0,s=function(e){if(!o.default.isElement(e))throw new TypeError("参数应是HTML Element");for(var t=e.offsetTop,r=e,n=0;n<999&&(r=r.offsetParent)!==document.body;n+=1)t+=r.offsetTop;return t},l=function(e){if(!o.default.isElement(e))throw new TypeError("参数应是HTML Element");for(var t=o.default.of(e).parents(),r=e.offsetLeft,n=0;n<t.length;n+=1){var i=t[n];if(o.default.isElement(i)){if("BODY"===i.tagName&&"HTML"===i.tagName)break;if(r+=i.offsetLeft,i.offsetParent===document.body)break}}return r},c=function(){for(var e=o.default.of("<tr>").addClass("week"),t=0;t<7;t+=1){var r=o.default.of("<td>");e.append(r)}return e},d=function(){for(var e=o.default.of("<div>").addClass("datepicker hide"),t=o.default.of("<table>").attr("border",1).attr("cellspacing",2),r=function(){var e=o.default.of("<tr>"),t=o.default.of("<th>").text("◂").addClass("prev-month"),r=o.default.of("<th>"),n=o.default.of("<th>").text("▸").addClass("next-month"),i=o.default.of("<th>").attr("colspan",2).addClass("month"),a=o.default.of("<input>").attr("type","number").addClass("year");return[t,r,o.default.of("<th>").attr("colspan",2).append(a),i,n].forEach(function(t){e.append(t)}),e}(),n=function(){var e=o.default.of("<tr>").addClass("week-sign");return[o.default.of("<th>").text("日").addClass("text-red"),o.default.of("<th>").text("一"),o.default.of("<th>").text("二"),o.default.of("<th>").text("三"),o.default.of("<th>").text("四"),o.default.of("<th>").text("五"),o.default.of("<th>").text("六").addClass("text-red")].forEach(function(t){e.append(t)}),e}(),i=o.default.of("<thead>").append(r).append(n),a=o.default.of("<tbody>"),u=0;u<6;u+=1){var f=c();a.append(f)}return t.append(i).append(a),e.append(t),e.dom},h=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t||1!==t.nodeType||"text"!==t.getAttribute("type"))throw new TypeError("参数应是一个input[type=text]");var r=new Date;return this.input=t,this.body=d(),this.current=i.default.of(r),document.body.appendChild(this.body),this.fillDayPickerByDate(this.current.toDate()),this.bindEvent(),this}return n(e,[{key:"fillDayPickerByDate",value:function(e){var t=this;if(!(e&&e instanceof Date))throw new TypeError("参数应该是一个Date实例对象");this.current=i.default.of(e);var r=i.default.getMonthArray(this.current.toDate()),n=this.body.querySelector("tbody").querySelectorAll("tr");if(this.body.querySelector(".year").value=e.getFullYear(),this.body.querySelector(".month").innerText=e.getMonth()+1,5===r.length){var o=new Date(e.getFullYear(),e.getMonth()+1,6),a=i.default.getWeekArray(o);r.push(a)}return r.forEach(function(e,o){var i=n[o].querySelectorAll("td");e.forEach(function(e,n){var a=i[n];if(a.innerText=e,0===o?Number(e)>7?a.classList.add("prev-month"):a.classList.remove("prev-month"):o>=r.length-2&&(Number(e)<15?a.classList.add("next-month"):a.classList.remove("next-month")),t.current.day===e&&!a.classList.contains("prev-month")&&!a.classList.contains("next-month")){var u=t.body.querySelector(".current-picker");u&&u.classList.remove(".current-picker"),a.classList.add(".current-picker")}})}),this}},{key:"fillDayPickerByCurrent",value:function(){var e=this.current.toDate();return this.fillDayPickerByDate(e),this}},{key:"clearPicked",value:function(){return this.body.querySelectorAll(".current-picker").forEach(function(e){e.classList.remove(".current-picker")}),this}},{key:"bindMonthArrow",value:function(){var e=this,t=this.body.querySelector(".prev-month"),r=this.body.querySelector(".next-month");return t.addEventListener("click",function(){e.current.backOneMonth(),e.fillDayPickerByCurrent()}),r.addEventListener("click",function(){e.current.aheadOneMonth(),e.fillDayPickerByCurrent()}),this}},{key:"bindPickAction",value:function(){var e=this,t=this.body.querySelector("thead"),r=this.body.querySelector("tbody").querySelectorAll("td"),n=t.querySelector(".year"),o=t.querySelector(".month"),i=this.input;return r.forEach(function(t){t.addEventListener("click",function(){var r={year:Number(n.value),month:Number(o.innerText)-1,day:Number(t.innerText)};t.classList.contains("prev-month")?(r.month-=1,r.month<0&&(r.year-=1,r.month=11)):t.classList.contains("next-month")&&(r.month+=1,r.month>11&&(r.year+=1,r.month=0));var a=new Date(r.year,r.month,r.day);e.current.reset(a),e.clearPicked(),i.value=e.current.year+"-"+(e.current.month+1)+"-"+e.current.day,t.classList.add("current-picker"),e.body.classList.add("hide")})}),this}},{key:"bindTurnOn",value:function(){var e=this;return this.input.addEventListener("mousedown",function(t){t.stopPropagation(),o.default.of(e.body).removeClass("arrow-top arrow-bottom reel hide");var r=document.querySelectorAll(".datepicker"),n=s(e.input),i=l(e.input),a=function(e,t){if(!o.default.isElement(e)||!o.default.isElement(t))throw new TypeError("参数应是HTML Element");var r=s(t),n=r-window.scrollY,i=window.scrollY+window.innerHeight-(r+t.offsetHeight)>e.offsetHeight,a=n>e.offsetHeight;return!i&&a?r-e.offsetHeight:r+t.offsetHeight}(e.body,e.input),u=function(e,t){if(!o.default.isElement(e)||!o.default.isElement(t))throw new TypeError("参数应是HTML Element");var r=l(t);return document.body.offsetWidth-t.offsetWidth-r+t.offsetWidth>e.offsetWidth?r:r+t.offsetWidth-e.offsetWidth}(e.body,e.input),f=a<n?"arrow-bottom":"arrow-top",c=u<i?"pseudo-right":"";r.forEach(function(t){e.body.isSameNode(t)||t.classList.add("hide")}),e.fillDayPickerByCurrent(),o.default.of(e.body).addClass("reel "+f+" "+c),e.body.style.top=a+"px",e.body.style.left=u+"px"}),this}},{key:"bindTurnOff",value:function(){return!u&&(u+=1,document.body.addEventListener("mousedown",function(e){var t=e.target;document.querySelectorAll(".datepicker").forEach(function(e){o.default.of(t).hasParent(e)||e.classList.add("hide")})}),this)}},{key:"bindYearInput",value:function(){var e=this,t=this.body.querySelector(".year"),r=this.body.querySelector(".month");t.addEventListener("input",function(){var n=Number(t.value);if(!Number.isSafeInteger(n)||n<1900||n>5e3)return!1;var o={year:n,month:Number(r.innerText)-1,day:1},i=new Date(o.year,o.month,o.day);return e.fillDayPickerByDate(i),e})}},{key:"bindEvent",value:function(){(function(){if(f)return!1;f+=1;var e=function(){var e=window.innerHeight;document.body.style.minHeight=e+"px"};window.addEventListener("resize",function(){e()}),e()})(),this.bindMonthArrow(),this.bindPickAction(),this.bindTurnOn(),this.bindTurnOff(),this.bindYearInput()}}]),e}(),y=function(e){return new h(e)};window.datepicker=y,r.default=y},{"./dom":3,"./customDate":4}]},{},[1]);
},{}],14:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../dom"),e=d(t),a=require("../lib/datepicker"),i=d(a),n=require("./component"),s=d(n);function d(t){return t&&t.__esModule?t:{default:t}}var o={query:"mission-form",url:"./assets/components/missionForm.html",data:function(){return{inited:0}},selectors:{contentInput:"input[name=content]",dateInput:"input[name=date]",cancelForm:".cancel-form",submit:".submit"},methods:{formSubmit:function(){var t=e.default.of(this.elements.contentInput).attr("value");if(!t)return!1;var a=e.default.of(this.elements.dateInput).attr("value")||"",i=e.default.of(this.template).attr("data-item-id"),n=e.default.of(this.template).attr("data-cid"),s={content:t,date:a};return i?(s.id=Number(i),s.cid=n,this.dispatchEvent("update",s)):this.dispatchEvent("create",s),s},fill:function(){this.present=this.present||{},this.data.content=this.present.content||"",this.data.date=this.present.date||"",this.data.id=this.present.id||"",this.data.cid=this.present.cid||"",this.data.submitText=this.data.cid?"更新任务":"新建任务",e.default.of(this.elements.contentInput).attr("value",this.data.content),e.default.of(this.elements.dateInput).attr("value",this.data.date),e.default.of(this.template).attr("data-item-id",this.data.id),e.default.of(this.template).attr("data-cid",this.data.cid),e.default.of(this.elements.submit).attr("text",this.data.submitText)},hide:function(){return e.default.of(this.template).addClass("hide"),this},show:function(){return e.default.of(this.template).removeClass("hide"),this},selectDate:function(t){if(!(t instanceof Date))throw new TypeError(t+" 不是Date的实例对象")}},created:function(){var t=this;if(this.methods.show(),!this.data.inited){this.data.inited=1;var a=(0,i.default)(this.elements.dateInput);e.default.of(a.body).attr("data-c-id","c"+this.componentId),e.default.of(this.elements.submit).on("click",function(){t.methods.formSubmit()}),e.default.of(this.elements.cancelForm).on("click",function(a){a.stopPropagation();var i=e.default.of(t.template).attr("data-cid");if(i){var n=s.default.find(i);n&&t.replaceSelf(n)}else t.methods.hide();t.elements.contentInput.blur()})}this.methods.fill()}};exports.default=o;
},{"../dom":6,"../lib/datepicker":18,"./component":4}],9:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../dom"),t=u(e),n=require("../indexeddb/missions"),i=u(n),r=require("./component"),o=u(r),a=require("./missionListItem"),d=u(a),s=require("../components/missionForm"),f=u(s);function u(e){return e&&e.__esModule?e:{default:e}}var l={query:"mission-content",url:"./assets/components/missionInbox.html",data:function(){return{counter:0,formSeen:!1}},selectors:{showForm:".show-form",list:".body ul",createMission:".create-mission"},methods:{loadDB:function(){var e=this;i.default.ready().then(function(){return i.default.getAll()}).then(function(n){n.sort(function(e,t){var n=new Date(e.date),i=new Date(t.date);return n.getTime()>i.getTime()}).forEach(function(n){var i=t.default.of("<mission-list-item>").dom;t.default.of(i).insertBefore(e.elements.createMission);var r=Object.assign(n,{formId:e.data.formId}),a=Object.assign({present:r},d.default);o.default.pjaxCreate(a)})})},initForm:function(){var e=this,n=t.default.of("<mission-form>").dom;t.default.of(n).insertBefore(this.elements.createMission),o.default.pjaxCreate(f.default).then(function(t){return t.methods.hide(),e.data.formId=t.componentId,t}).then(function(i){return t.default.of(e.elements.showForm).on("click",function(){var r=t.default.of(i.template).attr("data-cid");if(r){var a=o.default.find(r);a&&i.replaceSelf(a)}t.default.of(n).insertBefore(e.elements.createMission),i.present={},i.replaceElement(n),i.methods.show()}),i}).then(function(n){n.addEventListener("create",function(r){return!!r.detail.content&&(i.default.ready().then(function(){return i.default.set(r.detail)}).then(function(n){var i=t.default.of("<mission-list-item>").dom;t.default.of(i).insertBefore(e.elements.createMission);var a={formId:e.data.formId,content:r.detail.content,date:r.detail.date,id:n},s=Object.assign({present:a},d.default);return o.default.pjaxCreate(s)}).then(function(e){n.refresh(),n.methods.hide(),e.template.focus()}),n)}),n.addEventListener("update",function(e){if(!e.detail.content)return!1;var t={content:e.detail.content,date:e.detail.date,id:e.detail.id};return i.default.ready().then(function(){return i.default.set(t)}).then(function(){var i=o.default.find(e.detail.cid);i.present.content=t.content,i.present.date=t.date,i.present.id=t.id,n.replaceSelf(i)}),n})})},init:function(){return!this.data.inited&&(this.data.inited=1,this.methods.initForm(),this)}},created:function(){this.methods.loadDB(),this.methods.init()}};exports.default=l;
},{"../dom":6,"../indexeddb/missions":12,"./component":4,"./missionListItem":13,"../components/missionForm":14}],15:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./missionListItem"),t=f(e),n=require("./missionForm"),r=f(n),i=require("../indexeddb/missions"),d=f(i),a=require("./component"),o=f(a),s=require("../dom"),u=f(s);function f(e){return e&&e.__esModule?e:{default:e}}var m=new Date,c={query:"mission-card-expired",url:"./assets/components/missionCardExpired.html",data:function(){return{}},children:{missionForm:r.default},selectors:{cardBody:".card-body",dayMark:".day-mark",form:"mission-form"},methods:{init:function(){return!this.data.inited&&(this.data.inited=1,u.default.of(this.elements.dayMark).text("过期"),this.methods.initForm(),this.methods.loadDB(),this)},initForm:function(){var e=this.children.missionForm;this.data.formId=e.componentId,e.methods.hide(),e.addEventListener("update",function(t){if(!t.detail.content)return!1;var n={content:t.detail.content,date:t.detail.date,id:t.detail.id};return d.default.ready().then(function(){return d.default.set(n)}).then(function(){var r=o.default.find(t.detail.cid);r.present.content=n.content,r.present.date=n.date,r.present.id=n.id,e.replaceSelf(r),e.present={}}),e})},appendItem:function(e){var n=e||{};n.cid=this.componentId,n.formId=this.data.formId;var r=Object.assign({present:n},t.default);return this.insertComponent(r,this.elements.form,-1)},loadDB:function(){var e=this,t=new Promise(function(e){return e(1)});return d.default.ready().then(function(){return d.default.getAll()}).then(function(e){return e.filter(function(e){if(!e.date)return!1;var t=new Date(e.date);return m>t&&m.getDate()!==t.getDate()}).sort(function(e,t){var n=new Date(e.date),r=new Date(t.date);return n.getTime()>r.getTime()})}).then(function(n){n.forEach(function(n){t=t.then(function(){var t=Object.assign(n,{formId:e.data.formId});return e.methods.appendItem(t)})})}),t}},created:function(){this.methods.init()}};exports.default=c;
},{"./missionListItem":13,"./missionForm":14,"../indexeddb/missions":12,"./component":4,"../dom":6}],16:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./missionForm"),e=h(t),a=require("./component"),n=h(a),i=require("../dom"),d=h(i),r=require("../indexeddb/missions"),s=h(r),o=require("./missionListItem"),f=h(o);function h(t){return t&&t.__esModule?t:{default:t}}var u=new Date,m=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],c=function(t){if(!(t instanceof Date))throw new TypeError(t+"不是Date的实例化对象");return t.toLocaleDateString().replace(/\//g,"-")},l=function(t,e){var a=new Date(t.toLocaleDateString());return(new Date(e.toLocaleDateString()).getTime()-a.getTime())/864e5},p={query:"mission-card",url:"./assets/components/missionCard.html",data:function(){return{}},selectors:{form:"mission-form",cardHeader:".card-header",dayMark:".day-mark",dateMark:".date-mark",showForm:".show-form",createMission:".create-mission"},children:{missionForm:e.default},methods:{init:function(){return!this.data.inited&&(this.data.now=u,this.methods.fill(),this.methods.initForm(),this.methods.loadDB(),this.data.inited=1,this)},loadDB:function(){var t=this;return!!this.data.date&&s.default.ready().then(function(){return s.default.findItems({date:c(t.data.date)})}).then(function(e){e.map(function(e){var a=Object.assign(e,{cid:t.componentId,formId:t.data.formId}),n=Object.assign({present:a},f.default);return t.insertComponent(n,t.elements.form,-1),t})})},fill:function(){return this.present.date&&(this.data.date=this.present.date,this.data.dayMark=m[this.data.date.getDay()],this.data.dateMark=this.data.date.getMonth()+1+"月"+this.data.date.getDate()+"日",this.data.differDay=l(this.data.now,this.data.date),0===this.data.differDay?this.data.dayMark="今天":1===this.data.differDay&&(this.data.dayMark="明天"),d.default.of(this.elements.dayMark).attr("text",this.data.dayMark),d.default.of(this.elements.dateMark).attr("text",this.data.dateMark)),this},appendItem:function(t){var e=t||{};e.cid=this.componentId,e.formId=this.data.formId;var a=Object.assign({present:e},f.default);return this.insertComponent(a,this.elements.form,-1)},initForm:function(){var t=this,e=this.children.missionForm;if(this.data.formId=e.componentId,this.data.date){var a=c(this.data.date);e.present.date=a,e.methods.hide().methods.fill()}d.default.of(this.elements.showForm).on("click",function(){var a=e.data.cid;if(a){var i=n.default.find(a);i&&e.replaceSelf(i)}e.present={},e.methods.show().methods.fill(),d.default.of(e.template).insertBefore(t.elements.createMission)}),e.addEventListener("create",function(a){return!!a.detail.content&&(s.default.ready().then(function(){return s.default.set(a.detail)}).then(function(e){var n=Object.assign({id:e,cid:t.componentId,formId:t.data.formId},a.detail),i=Object.assign({present:n},f.default);return t.insertComponent(i,t.elements.form,-1)}).then(function(){e.present={},e.methods.hide()}),t)}),e.addEventListener("update",function(t){if(!t.detail.content)return!1;var a={content:t.detail.content,date:t.detail.date,id:t.detail.id};return s.default.ready().then(function(){return s.default.set(a)}).then(function(){var i=n.default.find(t.detail.cid);i.present.content=a.content,i.present.date=a.date,i.present.id=a.id,e.replaceSelf(i),e.present={}}),e})}},created:function(){this.methods.init()}};exports.default=p;
},{"./missionForm":14,"./component":4,"../dom":6,"../indexeddb/missions":12,"./missionListItem":13}],10:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./missionCardExpired"),t=r(e),n=require("./missionCard"),i=r(n);function r(e){return e&&e.__esModule?e:{default:e}}var o={query:"mission-content",url:"./assets/components/missionToday.html",data:function(){return{}},methods:{init:function(){return!this.data.inited&&(this.data.inited=1,this)},loadChildren:function(){var e=this;return new Promise(function(e){return e(1)}).then(function(){return e.appendChildComponent(t.default,e.template)}).then(function(){var t={present:{date:new Date}},n=Object.assign(t,i.default);return e.appendChildComponent(n,e.template)})}},created:function(){this.methods.init(),this.methods.loadChildren()}};exports.default=o;
},{"./missionCardExpired":15,"./missionCard":16}],11:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./missionCard"),t=n(e);function n(e){return e&&e.__esModule?e:{default:e}}var i=new Date,r={query:"mission-content",url:"./assets/components/missionNextWeek.html",data:function(){return{}},selectors:{},methods:{init:function(){return!this.data.inited&&(this.methods.loadNextWeek(),this.data.inited=1,this)},loadNextWeek:function(){var e=this,n=new Promise(function(e){return e(1)}),r=i.getFullYear(),o=i.getMonth();return[0,1,2,3,4,5,6].map(function(e,t){return new Date(r,o,i.getDate()+t)}).map(function(e){var n={present:{date:e}};return Object.assign(n,t.default)}).forEach(function(t){n=n.then(function(){return e.appendChildComponent(t,e.template)})}),n}},created:function(){this.methods.init()}};exports.default=r;
},{"./missionCard":16}],5:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./inbox"),t=c(e),r=require("./missionToday"),n=c(r),i=require("./missionNextWeek"),a=c(i),o=require("../dom"),s=c(o),u=require("./component"),d=c(u);function c(e){return e&&e.__esModule?e:{default:e}}var h={query:"router",url:"./assets/components/router.html",data:function(){return{counter:1,current:this,inited:0}},route:{inbox:t.default,today:n.default,nextWeek:a.default},methods:{init:function(){return!this.data.inited&&(this.data.href=window.location.href,this.data.inited=1,this)},render:function(e,t){var r=this,n=String(e),i=this.route[n];if(!i)throw new Error("路径"+e+"对应Component不存在");var a=t instanceof Object?t:{},o=i.present||{};return i.present=Object.assign(o,a),i.query=this.data.current.template,this.data.current.replaceSelf(i).then(function(t){d.default.destroy(r.data.current),r.data.current=t;var n=r.data.href+"#"+e;window.history.pushState(a,0,n)})},restore:function(){return!s.default.of(this.data.current.template).hasParent(document.body)&&(s.default.of(this.data.current.template).replace(this.template),this.data.current=this.template,this)},viewa:function(){this.methods.render("missionInboxParam")},viewb:function(){this.methods.render("missionTodayParam")},viewc:function(){this.methods.render("missionNextWeekParam")}},created:function(){}};exports.default=h;
},{"./inbox":9,"./missionToday":10,"./missionNextWeek":11,"../dom":6,"./component":4}],2:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./component"),t=r(e),n=require("./router"),o=r(n);function r(e){return e&&e.__esModule?e:{default:e}}var u=0,c=function(){return!u&&(document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("#inbox"),n=document.querySelector("#today"),r=document.querySelector("#next-week");t.default.pjaxCreate(o.default).then(function(t){window.router=t,e.onclick=function(){t.methods.render("inbox")},n.onclick=function(){t.methods.render("today")},r.onclick=function(){t.methods.render("nextWeek")}}).then(function(){n.click()})}),u=1)};exports.default=c;
},{"./component":4,"./router":5}],1:[function(require,module,exports) {
"use strict";var e=require("./components/main"),t=u(e);function u(e){return e&&e.__esModule?e:{default:e}}(0,t.default)();
},{"./components/main":2}]},{},[1], null)
//# sourceMappingURL=/index.map