parcelRequire=function(e,r,n,t){function i(n,t){function o(e){return i(o.resolve(e))}function c(r){return e[n][1][r]||r}if(!r[n]){if(!e[n]){var l="function"==typeof parcelRequire&&parcelRequire;if(!t&&l)return l(n,!0);if(u)return u(n,!0);if(f&&"string"==typeof n)return f(n);var p=new Error("Cannot find module '"+n+"'");throw p.code="MODULE_NOT_FOUND",p}o.resolve=c;var a=r[n]=new i.Module(n);e[n][0].call(a.exports,o,a,a.exports,this)}return r[n].exports}function o(e){this.id=e,this.bundle=i,this.exports={}}var u="function"==typeof parcelRequire&&parcelRequire,f="function"==typeof require&&require;i.isParcelRequire=!0,i.Module=o,i.modules=e,i.cache=r,i.parent=u;for(var c=0;c<n.length;c++)i(n[c]);if(n.length){var l=i(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):t&&(this[t]=l)}return i}({16:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,a=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,o=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,i=function(){function i(e){if(n(this,i),!r||!a||!o)throw new Error("您的浏览器不支持indexedDB");return this.name=this.name||e,this.databaseName="myEncapsulation",this}return t(i,[{key:"setDB",value:function(e){var t=this;if(!(e&&e instanceof IDBDatabase))throw new TypeError("参数应是数据库对象");return this.database=e,this.version=this.database.version,this.database.onclose=function(){t.database.isOpen=!1},e}},{key:"closeDB",value:function(){return this.database&&this.database instanceof IDBDatabase&&this.database.close()}},{key:"openDB",value:function(e){var t=this;if(e){if(!Number.isSafeInteger(e))throw new TypeError("版本号只能是整数");if(e<this.version)throw new TypeError("新版本号不能比当前版本号低")}var n=e&&Number.isSafeInteger(e)&&e>this.version?e:this.version;return this.closeDB(),new Promise(function(a,o){var i=e&&Number.isSafeInteger(e)&&e>t.version?r.open(t.databaseName,n):r.open(t.databaseName);i.onsuccess=function(){t.setDB(i.result),t.database.isOpen=!0,a(t.database)},i.onerror=function(e){o(e.target.error)},i.onupgradeneeded=function(e){t.setDB(e.target.result);var n=e.target.transaction;n.objectStoreNames.contains(t.name)||(t.database.createObjectStore(t.name,{keyPath:"id",autoIncrement:!0}),n.objectStore(t.name).createIndex("id","id",{unique:!0}))}})}},{key:"ready",value:function(){var e=this;return this.openDB().then(function(t){return e.setDB(t)})}},{key:"isReady",value:function(){return this.database&&this.database instanceof IDBDatabase&&this.database.isOpen}},{key:"addColumn",value:function(t,n){var a=this;if(!t||"string"!=typeof t)throw new TypeError("索引名称必须存在且为字符串");if(n&&"object"!==(void 0===n?"undefined":e(n)))throw new TypeError("索引选项应是对象类型");var o={};o.unique=n&&n.unique;var i=this.version+1;return this.closeDB(),new Promise(function(e,n){var s=r.open(a.databaseName,i);s.onsuccess=function(){a.setDB(s.result),a.database.isOpen=!0,e(a.database)},s.onerror=function(e){n(e.target.error)},s.onupgradeneeded=function(e){var n=e.target.result,r=e.target.transaction;a.database=n,a.version=a.database.version;var i=r&&r.objectStoreNames.contains(a.name)?r.objectStore(a.name):n.createObjectStore(a.name,{keyPath:"id",autoIncrement:!0});i.indexNames.contains("id")||i.createIndex("id","id",{unique:!0}),i.indexNames.contains(t)||i.createIndex(t,t,{unique:o.unique})}})}},{key:"deleteColumn",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new TypeError("需要一个字符串类型的索引名");this.closeDB();var n=this.version+1;return new Promise(function(a,o){var i=r.open(t.databaseName,n);i.onsuccess=function(){t.setDB(i.result),t.database.isOpen=!0,a(t.database)},i.onerror=function(e){t.database=i.result,t.version=i.result.version,t.database.close(),o(e.target.error)},i.onupgradeneeded=function(n){var r=n.target.result,a=n.target.transaction;t.database=r,t.version=t.database.version;var o=a&&a.objectStoreNames.contains(t.name)?a.objectStore(t.name):r.createObjectStore(t.name,{keyPath:"id",autoIncrement:!0});o.indexNames.contains("id")||o.createIndex("id","id",{unique:!0}),o.indexNames.contains(e)&&o.deleteIndex(e)}})}},{key:"addColumns",value:function(t){var n=this;if(!(t&&t instanceof Array))throw new TypeError("列名组应该是一个数组");var a=[];t.forEach(function(t){var n=void 0===t?"undefined":e(t);if("string"===n)a.push({index:t,unique:!1});else{if("object"!==n)throw new TypeError("索引列格式错误");a.push({index:t.index,unique:t.unique})}}),this.closeDB();var o=this.version+1;return new Promise(function(e,t){var i=r.open(n.databaseName,o);i.onsuccess=function(){n.setDB(i.result),n.database.isOpen=!0,e(n.database)},i.onerror=function(e){n.database=i.result,n.version=i.result.version,n.database.close(),t(e.target.error)},i.onupgradeneeded=function(e){var t=e.target.result,r=e.target.transaction;n.database=t,n.version=n.database.version;var o=r&&r.objectStoreNames.contains(n.name)?r.objectStore(n.name):t.createObjectStore(n.name,{keyPath:"id",autoIncrement:!0});o.indexNames.contains("id")||o.createIndex("id","id",{unique:!0}),a.forEach(function(e){o.indexNames.contains(e.index)||o.createIndex(e.index,e.index,{unique:e.unique})}),n.database=t}})}},{key:"deleteColumns",value:function(e){var t=this;if(!(e&&e instanceof Array))throw new TypeError("需要一个包含索引名的数组");e.forEach(function(e){if(!e||"string"!=typeof e)throw new TypeError("索引名不是字符串类型")}),this.closeDB();var n=this.version+1;return new Promise(function(a,o){var i=r.open(t.databaseName,n);i.onsuccess=function(){t.setDB(i.result),t.database.isOpen=!0,a(t.database)},i.onerror=function(e){t.database=i.result,t.version=i.result.version,t.database.close(),o(e.target.error)},i.onupgradeneeded=function(n){var r=n.target.result,a=n.target.transaction;t.database=r,t.version=t.database.version;var o=a&&a.objectStoreNames.contains(t.name)?a.objectStore(t.name):r.createObjectStore(t.name,{keyPath:"id",autoIncrement:!0});o.indexNames.contains("id")||o.createIndex("id","id",{unique:!0}),e.forEach(function(e){o.indexNames.contains(e)&&o.deleteIndex(e)})}})}},{key:"deleteItem",value:function(e){if(!Number.isSafeInteger(e))throw new TypeError("参数只能是目标数据的id属性值");if(!this.isReady())throw new Error("数据库尚未准备好");var t=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(n,r){var a=t.delete(e);a.onsuccess=function(){n(a.result)},a.onerror=function(e){r(e.target.error)}})}},{key:"deleteItems",value:function(e){var t=this;if(!(e instanceof Array)||0===e.length)throw new TypeError("参数只能是目标数据的id属性值组成的数组且不能为空");e.forEach(function(e){if(!Number.isSafeInteger(e))throw new TypeError("id属性值应是整数")});var n=this.ready();return e.forEach(function(e){n=n.then(function(){return t.deleteItem(e)})}),n}},{key:"delete",value:function(e){var t=Number.isSafeInteger(e),n=e instanceof Array;if(!t&&!n)throw new TypeError("参数只能是目标数据的id属性值或由id组成的数组");var r=void 0;return t?r=this.deleteItem(e):n&&(r=this.deleteItems(e)),r}},{key:"setItem",value:function(t){if(!t||"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("参数只能是一个对象");if(void 0!==t.id&&!Number.isSafeInteger(t.id))throw new TypeError("参数的id属性只能为整数");if(!this.isReady())throw new Error("数据库尚未准备好");var n=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(e,r){var a=n.put(t);a.onsuccess=function(){e(a.result)},a.onerror=function(e){r(e.target.error)}})}},{key:"setItems",value:function(t){var n=this;if(!(t&&t instanceof Array))throw new TypeError("参数应是一个数组");if(t.forEach(function(t){if(!t||"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("参数只能是一个对象")}),!this.isReady())throw new Error("数据库尚未准备好");var r=this.ready();return t.forEach(function(e){r=r.then(function(){return n.setItem(e)})}),r}},{key:"set",value:function(t){var n=t instanceof Array,r="object"===(void 0===t?"undefined":e(t));if(!r&&!n)throw new TypeError("参数只能是目标数据的id属性值或由id组成的数组");var a=void 0;return n?a=this.setItems(t):r&&(a=this.setItem(t)),a}},{key:"getItem",value:function(e){if(!Number.isSafeInteger(e))throw new TypeError("参数只能是目标数据的id属性值");if(!this.isReady())throw new Error("数据库尚未准备好");var t=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(n,r){var a=t.get(e);a.onsuccess=function(){n(a.result)},a.onerror=function(e){r(e.target.error)}})}},{key:"getItems",value:function(e){if(!(e instanceof Array)||0===e.length)throw new TypeError("参数只能是目标数据的id属性值组成的数组且不能为空");e.forEach(function(e){if(!Number.isSafeInteger(e))throw new TypeError("id属性值应是整数")});var t=e.sort(),n=o.bound(t[0],t[t.length-1]);if(!this.isReady())throw new Error("数据库尚未准备好");var r=this.database.transaction(this.name,"readwrite").objectStore(this.name);return new Promise(function(e,t){var a=r.getAll(n);a.onsuccess=function(){e(a.result)},a.onerror=function(e){t(e.target.error)}}).then(function(e){var n=[];return e.forEach(function(e){t.includes(e.id)&&n.push(e)}),n})}},{key:"get",value:function(e){var t=Number.isSafeInteger(e),n=e instanceof Array;if(!t&&!n)throw new TypeError("参数只能是目标数据的id属性值或由id组成的数组");var r=void 0;return t?r=this.getItem(e):n&&(r=this.getItems(e)),r}},{key:"getAll",value:function(e){var t=e||"id";if("string"!=typeof t)throw new TypeError("索引名只能是字符串");if(!this.isReady())throw new Error("数据库尚未准备好");var n=this.database.transaction(this.name,"readwrite").objectStore(this.name).index(t);return new Promise(function(e,t){var r=n.getAll();r.onsuccess=function(){e(r.result)},r.onerror=function(e){t(e.target.error)}})}},{key:"findItems",value:function(t){if(!t||"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("参数应该是一个对象");if(!this.isReady())throw new Error("数据库尚未准备好");var n=this.database.transaction(this.name,"readwrite").objectStore(this.name),r=Object.keys(t),a=n.index(r[0]),i=o.only(t[r[0]]);return new Promise(function(e,t){var n=a.getAll(i);n.onsuccess=function(){e(n.result)},n.onerror=function(e){t(e.target.error)}}).then(function(e){var n=[];return e.forEach(function(e){var a=1;r.forEach(function(n){e[n]!==t[n]&&(a=0)}),a&&n.push(e)}),n})}}],[{key:"openDB",value:function(e){if(!e||"string"!=typeof e)throw new TypeError("数据库名不能为"+e);return new Promise(function(t,n){var a=r.open(e);a.onsuccess=function(){var e=a.result;e.isOpen=!0,e.onclose=function(){e.isOpen=!1},t(e)},a.onerror=function(e){return n(e.target.error)}})}}]),i}();exports.default=i;
},{}],4:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=void 0,t=require("./store"),n=r(t);function r(e){return e&&e.__esModule?e:{default:e}}var i=new n.default("Missions");i.create=function(e){return i.set(e)},i.save=function(e){return i.set(e)},i.init=function(){return 1===i.init?e:(i.init=1,i.ready().then(function(){return i.addColumns(["date","content","order"])}))},i.init(),exports.default=i;
},{"./store":16}],2:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(e){return"string"==typeof e},n=function(e){return!(!e||!r(e))},o=function(e){if(!n(e))throw new TypeError("参数classes不能为 "+e);return e.replace(/\s+/g," ").split(" ")},i=0,a=function(){function r(e){if(t(this,r),!e)throw new TypeError("参数无效");if(e instanceof r)this.dom=e.dom;else if(e instanceof HTMLElement)this.dom=e;else if(n(e)){var o=e.match(/^<(.+)>$/);this.dom=o?document.createElement(o[1]):document.querySelector(e)}return this}return e(r,[{key:"attr",value:function(e,t){if(!n(e))throw new TypeError("参数key不能为 "+e);var r=void 0;return e.toLocaleLowerCase().match(/^text$/)?r=this.text(t):e.toLocaleLowerCase().match(/^html$/)?r=this.html(t):"INPUT"===this.dom.tagName&&"value"===e?void 0!==t?(this.dom.value=String(t),r=this):r=this.dom.value:void 0!==t?(this.dom.setAttribute(e,t),r=this):r=this.dom.getAttribute(e),r}},{key:"addClass",value:function(e){var t=this;return o(e).forEach(function(e){t.dom.classList.contains(e)||t.dom.classList.add(e)}),this}},{key:"removeClass",value:function(e){var t=this;return o(e).forEach(function(e){t.dom.classList.contains(e)&&t.dom.classList.remove(e)}),this}},{key:"hasClass",value:function(e){var t=this,r=!0;return o(e).forEach(function(e){t.dom.classList.contains(e)||(r=!1)}),r}},{key:"toggleClass",value:function(e){return this.hasClass(e)?this.removeClass(e):this.addClass(e),this}},{key:"append",value:function(e){var t=this;return(n(e)?document.querySelectorAll(e):[r.degenerate(e)]).forEach(function(e){t.dom.appendChild(e)}),this}},{key:"remove",value:function(e){var t=this;return(n(e)?this.dom.querySelectorAll(e):[r.degenerate(e)]).forEach(function(e){t.dom.removeChild(e)}),this}},{key:"text",value:function(e){var t=void 0;return void 0!==e?(this.dom.innerText=String(e),t=this):t=this.dom.innerText,t}},{key:"html",value:function(e){var t=void 0;return void 0!==e?(this.dom.innerHTML=String(e),t=this):t=this.dom.innerHTML,t}},{key:"child",value:function(e){return n(e)?this.dom.querySelector(e):r.degenerate(e)}},{key:"children",value:function(e){var t=void 0;if(void 0===e)t=this.dom.children();else{if(!n(e))throw new TypeError("selector不能为"+e);t=this.dom.querySelectorAll(e)}return t}},{key:"parent",value:function(e){return r.getParent(this.dom,e)}},{key:"parents",value:function(e){return r.getParents(this.dom,e)}},{key:"hasParent",value:function(e){return r.hasParent(this.dom,e)}},{key:"on",value:function(e,t){if(!n(e))throw new TypeError("event不能是"+e);if("function"!=typeof t)throw new TypeError("callback不能是"+t);return this.dom.addEventListener(e,t),this}},{key:"off",value:function(e,t){if(!n(e))throw new TypeError("event不能是"+e);if("function"!=typeof t)throw new TypeError("callback不能是"+t);return this.dom.removeEventListener(e,t),this}},{key:"clear",value:function(e){if(!n(e))throw new TypeError("event不能是"+e);return this.dom["on"+e]=void 0,this}}],[{key:"all",value:function(e){return document.querySelectorAll(e)}},{key:"of",value:function(e){return new r(e)}},{key:"degenerate",value:function(e){var t=void 0;if(e instanceof r)t=e.dom;else if(e instanceof HTMLElement)t=e;else{if(!n(e))throw new TypeError("参数query不能是"+e);t=document.querySelector(e)}return t}},{key:"isElement",value:function(e){return e&&e instanceof HTMLElement&&1===e.nodeType}},{key:"getParentsTree",value:function(e){if(!r.isElement(e))throw new TypeError("element不能是"+e);for(var t=[],n=e;n.parentElement;)n=n.parentElement,t.push(n);return t}},{key:"getParent",value:function(e,t){if(!r.isElement(e))throw new TypeError("element不能是"+e);var o=void 0,i=r.getParentsTree(e),a=document.querySelectorAll(t);if(void 0===t)o=e.parentElement;else{var u=void 0;if(n(t))u=i;else{if(!(t instanceof r))throw new TypeError("query不能是"+t);u=[t.dom]}u.forEach(function(e){a.forEach(function(t){t.isSameNode(e)&&(o=e)})})}return o}},{key:"getParents",value:function(e,t){if(!r.isElement(e))throw new TypeError("element不能是"+e);var o=void 0,i=r.getParentsTree(e),a=document.querySelectorAll(t);if(void 0===t)o=i;else{if(o=[],!n(t))throw new TypeError("query不能是"+t);i.forEach(function(e){a.forEach(function(t){t.isSameNode(e)&&o.push(e)})})}return o}},{key:"hasParent",value:function(e,t){if(!(n(t)||t instanceof r))throw new TypeError("query不能是"+t);return!!r.getParent(e,t)}},{key:"globalInit",value:function(){return!i&&(i+=1,HTMLCollection.prototype.forEach=Array.prototype.forEach,i)}}]),r}();a.globalInit(),exports.default=a;
},{}],9:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(e){return e instanceof KeyboardEvent&&13===e.keyCode},n=function(e){return e&&1===e.nodeType},t=function(e){return e&&"string"==typeof e},r=function(e){return e&&"function"==typeof e};exports.default={isElement:n,isKeyEnter:e,isString:t,isFunction:r};
},{}],10:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}(),n=require("./utils"),r=o(n),t=require("./dom"),a=o(t);function o(e){return e&&e.__esModule?e:{default:e}}function u(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i=a.default.of,c=function(){function n(){u(this,n)}return e(n,null,[{key:"prepareBox",value:function(){if(!document.body)throw new ReferenceError("页面加载未完成");var e=i("#alert-box")[0];return e||(e=i("<div>").attr("id","alert-box").dom,i(document.body).append(e)),e}},{key:"alert",value:function(e){if(!e)throw new TypeError("参数不能为"+e);if(!document.body)throw new ReferenceError("页面加载未完成");var r=n.prepareBox(),t=i("<div>").addClass("alert"),a=i("<span>").attr("name","message").html(e),o=i("<span>").attr("name","buttons"),u=i("<a>").attr("name","cancal").text("隐藏");return u.on("click",function(){t.dom.remove()}),o.append(u),t.append(a).append(o),i(r).append(t),t}},{key:"confirm",value:function(e,t,a){if(!e)throw new TypeError("参数不能为"+e);if(!document.body)throw new ReferenceError("页面加载未完成");var o=n.prepareBox(),u=i("<div>").addClass("confirm"),c=i("<span>").attr("name","message").html(e),p=i("<span>").attr("name","buttons"),d=i("<a>").attr("name","submit").text("确定");r.default.isString(a)&&d.text(a);var f=i("<a>").attr("name","cancal").text("隐藏");return t&&"function"==typeof t&&d.on("click",t),f.on("click",function(){u.dom.remove()}),p.append(f),u.append(c).append(p),i(o).append(u),u}}]),n}();exports.default=c;
},{"./utils":9,"./dom":2}],3:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),t=require("./indexeddb/missions"),n=u(t),r=require("./utils"),i=u(r),a=require("./dom"),o=u(a),d=require("./message"),s=u(d);function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var m=o.default.of,c=function(){function t(){if(l(this,t),t.instance instanceof t)return t.instance;if(this.element=document.querySelector("#mission"),this.listElement=document.querySelector("#mission-list"),this.formElement=document.querySelector("#mission-form"),this.adderElement=document.querySelector("#add-mission"),this.leftMenu=document.querySelector("#left-menu"),this.navbar=document.querySelector("nav"),this.contentHeader=this.element.querySelector("*[name=content-header]"),!(this.element&&this.listElement&&this.formElement&&this.adderElement))throw new ReferenceError("界面元素不完整");return this.init(),this.loadDB(),this.counter=1,t.instance=this,this}return e(t,[{key:"loadDB",value:function(){var e=this;return n.default.ready().then(function(){return n.default.getAll()}).then(function(n){n.sort(function(e,t){return Number(e.order)-Number(t.order)}).forEach(function(n){var r=t.createMissionItem(n.content,n.date,n.id);m(r).attr("order",n.order),m(e.listElement).append(r)})}),this}},{key:"init",value:function(){var e=this;if(1===this.init)return!1;var t=m(this.adderElement).child("*[name=open-form]");m(t).on("click",function(){var t=m(e.adderElement).parent();e.listElement.querySelectorAll(".mission-item").forEach(function(e){return m(e).removeClass("hide")}),t.insertBefore(e.formElement,e.adderElement),m(e.formElement).child("input[name=content]").value="",m(e.formElement).child("input[name=date]").value="",m(e.formElement).child("*[name=submit]").innerText="添加任务",m(e.formElement).attr("data-item-id","").removeClass("hide")});var n=m(this.formElement).child("button[name=submit]");m(n).on("click",function(){m(e.formElement).attr("data-item-id")?e.updateMission():e.createMission()}),m(this.formElement).children("input").forEach(function(e){m(e).on("keypress",function(e){i.default.isKeyEnter(e)&&n.click()})});var r=m(this.formElement).child("*[name=hide-form]");return m(r).on("click",function(){m(e.formElement).addClass("hide");var t=m(e.formElement).attr("data-item-id");if(t){var n=m("#"+t)[0];n&&m(n).removeClass("hide")}}),m(this.listElement).children("*[name=finish]").forEach(function(e){m(e).on("click",function(){var t=m(e).parents(".mission-item")[0];m(t).remove()})}),this.initDocument(),this.initWindow(),this.initContentHeader(),this.init=1,this}},{key:"initDocument",value:function(){var e=this;return!document.supportMission&&(document.ondragover=function(e){e.preventDefault()},document.ondrop=function(e){var t=e.dataTransfer.getData("Text").match(/^item-\d+$/),n=t&&t[0];if(i.default.isString(n)){var r=m("#"+n)[0];if(!r)return!1;m(r).removeClass("item-curtain").attr("draggable","false")}return!0},document.ondragend=function(){var t=e.listElement.querySelectorAll(".mission-item"),r=m(e.listElement).attr("drag"),a=Number(r.match(/^item-(\d+)$/)[1]),o=m("#"+r)[0],d=void 0;t.forEach(function(e,t){o.isSameNode(e)&&(d=t),m(e).removeClass("item-curtain").attr("draggable","false")});var u=t[d-1],l=t[d+1],c=i.default.isElement(u)?Number(m(u).attr("order")):0,f=i.default.isElement(l)?Number(m(l).attr("order")):c+2;if(!Number.isFinite(c)||!Number.isFinite(f))throw new ReferenceError("拖动的条目前后存在条目没有有效order属性");var h=(c+f)/2;n.default.ready().then(function(){return n.default.get(a)}).then(function(e){var t=e;return t.order=h,n.default.set(t)}).then(function(){m(o).attr("order",h),s.default.alert("位置已改变")}),m(e.listElement).attr("drag","")},document.supportMission=1,this)}},{key:"initWindow",value:function(){var e=this;return!window.supportMission&&(window.onresize=function(){e.readjustLeftMenuHeight()},window.addEventListener("load",function(){e.readjustLeftMenuHeight()}),window.supportMission=1,this)}},{key:"initContentHeader",value:function(){var e=this.contentHeader.querySelector("*[name=sort]"),t=e.nextElementSibling,n=t.querySelector(".curtain");i.default.isElement(e)&&e.addEventListener("click",function(){m(t).toggleClass("hide")}),i.default.isElement(n)&&n.addEventListener("mousedown",function(e){m(t).addClass("hide"),e.stopPropagation()})}},{key:"readjustLeftMenuHeight",value:function(){return this.leftMenu.style.height=window.innerHeight-100+"px",this}},{key:"createMission",value:function(){var e=this,r=this.formElement,i=m(r).child("input[name=content]");if(!i.value)return!1;var a=m(r).child("input[name=date]");this.counter+=1;var o={content:i.value,date:a.value,order:this.counter};return n.default.ready().then(function(){return n.default.create(o)}).then(function(n){var r=t.createMissionItem(i.value,a.value,n);i.value="",a.value="",m(e.listElement).append(r)}),m(this.formElement).attr("data-item-id",""),this}},{key:"updateMission",value:function(){var e=this,t=m(this.formElement).attr("data-item-id");if(!t)return!1;var r=m("#"+t)[0];if(!r)throw new ReferenceError("找不到#"+t+"元素");var i=m(this.formElement).child("input[name=content]"),a=m(this.formElement).child("input[name=date]"),o=i.value,d=a.value,s={id:Number(t.match(/^item-(\d+)$/)[1]),content:o,date:d};return n.default.ready().then(function(){return n.default.save(s)}).then(function(){m(r).child("*[name=content]").innerText=o,m(r).child("*[name=date]").innerText=d,m(r).removeClass("hide"),i.value="",a.value="",m(e.formElement).addClass("hide")}),this}},{key:"sortMissionsByDate",value:function(e){var t=this,r=[];this.listElement.querySelectorAll(".mission-item").forEach(function(e){r.push(e)});var i=r.sort(function(e,t){var n=e.querySelector("*[name=date]").innerText,r=t.querySelector("*[name=date]").innerText;return(n?new Date(n).getTime():0)>=(r?new Date(r).getTime():0)});("reverse"===e?i.reverse():i).forEach(function(e,r){var i=r+1,a=e.querySelector("*[name=content]").innerText,o=e.querySelector("*[name=date]").innerText,d={id:Number(e.id.match(/^item-(\d+)$/)[1]),content:a,date:o,order:i};n.default.ready().then(function(){return n.default.set(d)}).then(function(){e.setAttribute("order",i),t.listElement.appendChild(e)})})}}],[{key:"isElementComplete",value:function(){var e=document.querySelector("#mission"),t=document.querySelector("#mission-list"),n=document.querySelector("#mission-form"),r=document.querySelector("#add-mission");return e&&t&&n&&r}},{key:"transformItem",value:function(e){if(!i.default.isElement(e)||!e.classList.contains("mission-item"))throw new TypeError("不是任务列表的子元素");var t=m(e).parent(),n=e.nextSibling,r=m("#mission-form")[0],a=m(e).child("*[name=content]").innerText,o=m(e).child("*[name=date]").innerText,d=t.querySelectorAll(".mission-item"),s=m(r).child("*[name=submit]");return d.forEach(function(t){t.id!==e.id&&m(t).removeClass("hide")}),m(e).addClass("hide"),t.insertBefore(r,n),m(r).removeClass("hide").attr("data-item-id",e.id),m(r).child("input[name=content]").value=a,m(r).child("input[name=date]").value=o,m(s).text("保存"),r}},{key:"createMissionItem",value:function(e,r,i){if(!t.isElementComplete())throw new ReferenceError("界面元素不完整");var a=m("<li>").addClass("mission-item").attr("id","item-"+i),o=m("<div>").addClass("item-before"),d=m("<i>").addClass("fa fa-arrows"),s=m("<div>").addClass("item-left"),u=m("<div>").addClass("item-right"),l=m("<i>").addClass("fa fa-circle-o item-icon fa-lg").attr("name","finish"),c=m("<span>").attr("name","content").text(e),f=m("<span>").attr("name","date").addClass("text-sm-center").text(r),h=m("<a>").append(l);return window.link=h,d.on("mousedown",function(){a.attr("draggable","true")}),c.on("click",function(){t.transformItem(a.dom)}),h.on("click",function(){n.default.ready().then(function(){return n.default.delete(i)}).then(function(){return a.remove()})}),a.on("dragstart",function(e){var t=a.parent();m(t).attr("drag",a.dom.id),e.dataTransfer.setData("Text",a.dom.id),a.addClass("item-curtain")}),a.on("dragover",function(e){e.preventDefault();var t=a.parent(),n=a.dom.nextSibling,r=m(t).attr("drag"),i=m(t).child("#"+r),o={itemIndex:0,dragIndex:0},d=t.children;d.forEach=Array.prototype.forEach,d.forEach(function(e,t){a.dom.isSameNode(e)&&(o.itemIndex=t),i.isSameNode(e)&&(o.dragIndex=t)});var s=o.dragIndex>o.itemIndex?a.dom:n;t.insertBefore(i,s)}),a.on("drop",function(e){e.preventDefault();var t=a.parent(),n=a.dom.nextSibling,r=e.dataTransfer.getData("Text"),i=m(t).child("#"+r),o=i.nextSibling;t.insertBefore(a.dom,o),t.insertBefore(i,n),m(i).removeClass("item-curtain").attr("draggable","false")}),o.append(d),s.append(h).append(c),u.append(f),a.append(o).append(s).append(u),a.dom}},{key:"hideForm",value:function(){var e=document.querySelector("#mission-form");if(!i.default.isElement(e))throw new ReferenceError("没有找到mission-form");var t=m(e).child("*[name=hide-form]");if(!i.default.isElement(e))throw new ReferenceError("没有找到mission-form表单取消按钮");return t.click()}},{key:"getElement",value:function(){return document.querySelector("#mission")}}]),t}();exports.default=c;
},{"./indexeddb/missions":4,"./utils":9,"./dom":2,"./message":10}],5:[function(require,module,exports) {
var define;
var e,t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};parcelRequire=function(r,n,o,i){function a(e,t){function o(e){return a(o.resolve(e))}if(!n[e]){if(!r[e]){var i="function"==typeof parcelRequire&&parcelRequire;if(!t&&i)return i(e,!0);if(u)return u(e,!0);if(f&&"string"==typeof e)return f(e);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}o.resolve=function(t){return r[e][1][t]||t};var l=n[e]=new a.Module(e);r[e][0].call(l.exports,o,l,l.exports,this)}return n[e].exports}var u="function"==typeof parcelRequire&&parcelRequire,f="function"==typeof require&&require;a.isParcelRequire=!0,a.Module=function(e){this.id=e,this.bundle=a,this.exports={}},a.modules=r,a.cache=n,a.parent=u;for(var s=0;s<o.length;s++)a(o[s]);if(o.length){var l=a(o[o.length-1]);"object"==("undefined"==typeof exports?"undefined":t(exports))&&"undefined"!=typeof module?module.exports=l:"function"==typeof e&&e.amd&&e(function(){return l})}return a}({3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(e){return e&&1===e.nodeType},i=function(e){return e&&"string"==typeof e},a=function(e){return!!o(e)&&e.parentNode},u=function(e){if(!o(e))return!1;for(var t=[],r=e,n=0;n<999&&(r=a(r),o(r));n+=1)t.push(r);return t},f=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"==typeof t){var r=t.match(/^<(.+)>$/);if(!r)return document.querySelectorAll(t);var n=r[1].toLocaleUpperCase();this.dom=document.createElement(n)}else if(t instanceof e)this.dom=t.dom;else{if(!o(t)&&t!==document)throw console.warn(t),new TypeError("无效参数");this.dom=t}return this}return n(e,[{key:"attr",value:function(e,t){if(!e||!i(e))throw new TypeError("没有key参数");var r=this;return void 0!==t?this.dom.setAttribute(e,""+t):r=this.dom.getAttribute(e),r}},{key:"addClass",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");return e.split(" ").forEach(function(e){e&&t.dom.classList.add(e)}),this}},{key:"removeClass",value:function(e){var t=this;if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");return e.split(" ").forEach(function(e){e&&t.dom.classList.remove(e)}),this}},{key:"hasClass",value:function(e){if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");if(e.match(" "))throw new TypeError("参数不能含有空格");return this.dom.classList.contains(e)}},{key:"toggleClass",value:function(e){if(!e||"string"!=typeof e)throw new TypeError("参数应该是字符串");return this.hasClass(e)?this.removeClass(e):this.addClass(e),this}},{key:"append",value:function(t){var r=t instanceof e?t.dom:t;if(!r||1!==r.nodeType)throw new TypeError("参数不是html元素");return this.dom.appendChild(r),this}},{key:"remove",value:function(e){if(e){if(o(e))this.dom.removeChild(e);else if(i(e)){var t=this.dom.querySelector(e);this.dom.removeChild(t)}}else this.dom.remove();return this}},{key:"text",value:function(e){return this.dom.innerText=e,this}},{key:"html",value:function(e){return this.dom.innerHTML=e,this}},{key:"find",value:function(e){return this.dom.querySelector(e)}},{key:"children",value:function(e){return this.dom.querySelectorAll(e)}},{key:"parent",value:function(){var e=this.dom.parentNode;return e&&1===e.nodeType?e:void 0}},{key:"parents",value:function(e){var t=u(this.dom),r=[];return e&&i(e)?document.querySelectorAll(e).forEach(function(e){t.includes(e)&&r.push(e)}):r=t,r}},{key:"on",value:function(e,t){return this.dom.addEventListener(e,t),this}},{key:"off",value:function(e,t){return this.dom.removeEventListener(e,t),this}},{key:"hasParent",value:function(t){if(!e.isElement(t))return!1;var r=!1;return this.parents().forEach(function(e){t.isSameNode(e)&&(r=!0)}),r}}],[{key:"of",value:function(t){return new e(t)}},{key:"isElement",value:function(e){return e&&1===e.nodeType}}]),e}();r.default=f},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=[31,28,31,30,31,30,31,31,30,31,30,31],i=function(e){return Number.isInteger(e)&&e>1900&&e<5001},a=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t&&t instanceof Date))throw new TypeError("参数应是一个Date实例对象");return this.year=t.getFullYear(),this.month=t.getMonth(),this.day=t.getDate(),this}return n(e,[{key:"backOneMonth",value:function(){return this.month-=1,this.month<0&&(this.year-=1,this.month=11),this}},{key:"aheadOneMonth",value:function(){return this.month+=1,this.month>11&&(this.year+=1,this.month=0),this}},{key:"toDate",value:function(){return new Date(this.year,this.month,this.day)}},{key:"reset",value:function(t){var r=e.of(t);if(!r)throw new TypeError("哪里出现了问题");return this.year=r.year,this.month=r.month,this.day=r.day,this}}],[{key:"of",value:function(t){return new e(t)}},{key:"getMonths",value:function(e){if(!i(e))throw new TypeError("参数应该是一个数字，有效值1901-5000");var t=o;return e%4==0&&(t[1]=29),t}},{key:"getDaysCount",value:function(t,r){if(!i(t))throw new TypeError("参数应该是一个数字，有效值1901-5000");if(!function(e){return Number.isInteger(e)&&e>=0&&e<12}(r))throw new TypeError("参数应该是一个数字，有效值0-11");return e.getMonths(t)[r]}},{key:"getWeekArray",value:function(t){if(!(t instanceof Date))throw new TypeError("参数应该是一个Date实例对象");for(var r=[],n=e.getDaysCount(t.getFullYear(),t.getMonth()),o=new Date(t.getFullYear(),t.getMonth()-1,1),i=e.getDaysCount(o.getFullYear(),o.getMonth()),a=t.getDate()-t.getDay(),u=0;u<7;u+=1){var f=a+u;f>n?f-=n:f<1&&(f+=i),r.push(f)}return r}},{key:"getMonthArray",value:function(t){if(!(t&&t instanceof Date))throw new TypeError("参数应该是一个Date实例对象");var r=[],n=e.getDaysCount(t.getFullYear(),t.getMonth()),o=e.getWeekArray(t);r.push(o);for(var i=0;i<5;i+=1){var a=t.getDate()-t.getDay()-1-7*i;if(a>0){var u=new Date(t.getFullYear(),t.getMonth(),a),f=e.getWeekArray(u);r.unshift(f)}var s=t.getDate()-t.getDay()+7+7*i;if(s<=n){var l=new Date(t.getFullYear(),t.getMonth(),s),c=e.getWeekArray(l);r.push(c)}}return r}}]),e}();r.default=a},{}],1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=a(e("./dom")),i=a(e("./customDate"));function a(e){return e&&e.__esModule?e:{default:e}}var u=0,f=0,s=function(e){if(!o.default.isElement(e))throw new TypeError("参数应是HTML Element");for(var t=e.offsetTop,r=e,n=0;n<999&&(r=r.offsetParent)!==document.body;n+=1)t+=r.offsetTop;return t},l=function(e){if(!o.default.isElement(e))throw new TypeError("参数应是HTML Element");for(var t=o.default.of(e).parents(),r=e.offsetLeft,n=0;n<t.length;n+=1){var i=t[n];if(o.default.isElement(i)){if("BODY"===i.tagName&&"HTML"===i.tagName)break;if(r+=i.offsetLeft,i.offsetParent===document.body)break}}return r},c=function(){for(var e=o.default.of("<tr>").addClass("week"),t=0;t<7;t+=1){var r=o.default.of("<td>");e.append(r)}return e},d=function(){for(var e=o.default.of("<div>").addClass("datepicker hide"),t=o.default.of("<table>").attr("border",1).attr("cellspacing",2),r=function(){var e=o.default.of("<tr>"),t=o.default.of("<th>").text("◂").addClass("prev-month"),r=o.default.of("<th>"),n=o.default.of("<th>").text("▸").addClass("next-month"),i=o.default.of("<th>").attr("colspan",2).addClass("month"),a=o.default.of("<input>").attr("type","number").addClass("year");return[t,r,o.default.of("<th>").attr("colspan",2).append(a),i,n].forEach(function(t){e.append(t)}),e}(),n=function(){var e=o.default.of("<tr>").addClass("week-sign");return[o.default.of("<th>").text("日").addClass("text-red"),o.default.of("<th>").text("一"),o.default.of("<th>").text("二"),o.default.of("<th>").text("三"),o.default.of("<th>").text("四"),o.default.of("<th>").text("五"),o.default.of("<th>").text("六").addClass("text-red")].forEach(function(t){e.append(t)}),e}(),i=o.default.of("<thead>").append(r).append(n),a=o.default.of("<tbody>"),u=0;u<6;u+=1){var f=c();a.append(f)}return t.append(i).append(a),e.append(t),e.dom},h=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t||1!==t.nodeType||"text"!==t.getAttribute("type"))throw new TypeError("参数应是一个input[type=text]");var r=new Date;return this.input=t,this.body=d(),this.current=i.default.of(r),document.body.appendChild(this.body),this.fillDayPickerByDate(this.current.toDate()),this.bindEvent(),this}return n(e,[{key:"fillDayPickerByDate",value:function(e){var t=this;if(!(e&&e instanceof Date))throw new TypeError("参数应该是一个Date实例对象");this.current=i.default.of(e);var r=i.default.getMonthArray(this.current.toDate()),n=this.body.querySelector("tbody").querySelectorAll("tr");if(this.body.querySelector(".year").value=e.getFullYear(),this.body.querySelector(".month").innerText=e.getMonth()+1,5===r.length){var o=new Date(e.getFullYear(),e.getMonth()+1,6),a=i.default.getWeekArray(o);r.push(a)}return r.forEach(function(e,o){var i=n[o].querySelectorAll("td");e.forEach(function(e,n){var a=i[n];if(a.innerText=e,0===o?Number(e)>7?a.classList.add("prev-month"):a.classList.remove("prev-month"):o>=r.length-2&&(Number(e)<15?a.classList.add("next-month"):a.classList.remove("next-month")),t.current.day===e&&!a.classList.contains("prev-month")&&!a.classList.contains("next-month")){var u=t.body.querySelector(".current-picker");u&&u.classList.remove(".current-picker"),a.classList.add(".current-picker")}})}),this}},{key:"fillDayPickerByCurrent",value:function(){var e=this.current.toDate();return this.fillDayPickerByDate(e),this}},{key:"clearPicked",value:function(){return this.body.querySelectorAll(".current-picker").forEach(function(e){e.classList.remove(".current-picker")}),this}},{key:"bindMonthArrow",value:function(){var e=this,t=this.body.querySelector(".prev-month"),r=this.body.querySelector(".next-month");return t.addEventListener("click",function(){e.current.backOneMonth(),e.fillDayPickerByCurrent()}),r.addEventListener("click",function(){e.current.aheadOneMonth(),e.fillDayPickerByCurrent()}),this}},{key:"bindPickAction",value:function(){var e=this,t=this.body.querySelector("thead"),r=this.body.querySelector("tbody").querySelectorAll("td"),n=t.querySelector(".year"),o=t.querySelector(".month"),i=this.input;return r.forEach(function(t){t.addEventListener("click",function(){var r={year:Number(n.value),month:Number(o.innerText)-1,day:Number(t.innerText)};t.classList.contains("prev-month")?(r.month-=1,r.month<0&&(r.year-=1,r.month=11)):t.classList.contains("next-month")&&(r.month+=1,r.month>11&&(r.year+=1,r.month=0));var a=new Date(r.year,r.month,r.day);e.current.reset(a),e.clearPicked(),i.value=e.current.year+"-"+(e.current.month+1)+"-"+e.current.day,t.classList.add("current-picker"),e.body.classList.add("hide")})}),this}},{key:"bindTurnOn",value:function(){var e=this;return this.input.addEventListener("mousedown",function(t){t.stopPropagation(),o.default.of(e.body).removeClass("arrow-top arrow-bottom reel hide");var r=document.querySelectorAll(".datepicker"),n=s(e.input),i=l(e.input),a=function(e,t){if(!o.default.isElement(e)||!o.default.isElement(t))throw new TypeError("参数应是HTML Element");var r=s(t),n=r-window.scrollY,i=window.scrollY+window.innerHeight-(r+t.offsetHeight)>e.offsetHeight,a=n>e.offsetHeight;return!i&&a?r-e.offsetHeight:r+t.offsetHeight}(e.body,e.input),u=function(e,t){if(!o.default.isElement(e)||!o.default.isElement(t))throw new TypeError("参数应是HTML Element");var r=l(t);return document.body.offsetWidth-t.offsetWidth-r+t.offsetWidth>e.offsetWidth?r:r+t.offsetWidth-e.offsetWidth}(e.body,e.input),f=a<n?"arrow-bottom":"arrow-top",c=u<i?"pseudo-right":"";r.forEach(function(t){e.body.isSameNode(t)||t.classList.add("hide")}),e.fillDayPickerByCurrent(),o.default.of(e.body).addClass("reel "+f+" "+c),e.body.style.top=a+"px",e.body.style.left=u+"px"}),this}},{key:"bindTurnOff",value:function(){return!u&&(u+=1,document.body.addEventListener("mousedown",function(e){var t=e.target;document.querySelectorAll(".datepicker").forEach(function(e){o.default.of(t).hasParent(e)||e.classList.add("hide")})}),this)}},{key:"bindYearInput",value:function(){var e=this,t=this.body.querySelector(".year"),r=this.body.querySelector(".month");t.addEventListener("input",function(){var n=Number(t.value);if(!Number.isSafeInteger(n)||n<1900||n>5e3)return!1;var o={year:n,month:Number(r.innerText)-1,day:1},i=new Date(o.year,o.month,o.day);return e.fillDayPickerByDate(i),e})}},{key:"bindEvent",value:function(){(function(){if(f)return!1;f+=1;var e=function(){var e=window.innerHeight;document.body.style.minHeight=e+"px"};window.addEventListener("resize",function(){e()}),e()})(),this.bindMonthArrow(),this.bindPickAction(),this.bindTurnOn(),this.bindTurnOff(),this.bindYearInput()}}]),e}(),y=function(e){return new h(e)};window.datepicker=y,r.default=y},{"./dom":3,"./customDate":4}]},{},[1]);
},{}],12:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),r=require("../utils"),n=o(r);function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u={get:function(e,t){if("string"!=typeof e)throw new TypeError("路径错误");if(!(t instanceof Function))throw new TypeError("回调函数错误");var r=window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");r.open("GET",e,!0),r.send(),r.onreadystatechange=function(e){return 4===r.readyState&&200===r.status&&t(e)}}},l={get:function(e){if(!n.default.isString(e))throw new TypeError("参数url是路径 字符串类型");return new Promise(function(t){u.get(e,function(e){t(e.target.response)})})}},s=function(){function r(t){if(i(this,r),"object"!==(void 0===t?"undefined":e(t)))throw new TypeError("param应该是一个object");if(!n.default.isString(t.query))throw new TypeError("param.query应该是字符串类型querySelector参数");if(!n.default.isElement(t.template))throw new TypeError("param.template应该是一个HtmlElement");var o=Object.assign(this,t);if(this.selector=document.querySelector(this.query)||document.querySelector("*[query="+this.query+"]"),!n.default.isElement(this.selector))throw new TypeError("选择器 "+t.query+" 未找到匹配项");if(o.selectors&&"object"===e(o.selectors)){var u={};Object.keys(o.selectors).forEach(function(e){var t=o.selectors[e];if(t&&n.default.isString(t)){var r=o.template.querySelector(t);n.default.isElement(r)&&(u[e]=r)}}),Object.keys(u).length>0&&(u.template=o.template,o.elements=u)}o.methods&&"object"===e(o.methods)&&Object.keys(o.methods).forEach(function(e){var t=o.methods[e];t&&"function"==typeof t&&(o.methods[e]=t.bind(o))});try{n.default.isFunction(o.created)&&o.created(),o.implant(),n.default.isFunction(o.implanted)&&o.implanted()}catch(e){console.error(e)}return o}return t(r,[{key:"implant",value:function(){var e=this.style.getAttribute("scoped")||""===this.style.getAttribute("scoped"),t=this.selector.parentElement;if(this.template.setAttribute("query",this.query),t.replaceChild(this.template,this.selector),this.style)if(e)t.insertBefore(this.style,t.childNodes[0]);else{this.style.setAttribute("component",this.query);var r=document.querySelector("style[component="+this.query+"]");r?document.querySelector("head").replaceChild(this.style,r):document.querySelector("head").appendChild(this.style)}return this}}],[{key:"pjaxFormatHtml",value:function(e){return l.get(e).then(function(e){var t=document.createElement("html");t.innerHTML=e;var r=t.querySelectorAll("style"),n=t.querySelector("body");if(r.length>1)throw new TypeError("至多可以有一个<style>元素");if(1!==n.childElementCount)throw new TypeError("<body>内应有且只有一个根元素");return{template:n.firstElementChild,style:r[0]}})}},{key:"of",value:function(e){return new r(e)}},{key:"pjaxCreate",value:function(e){if(!n.default.isString(e.url))throw new TypeError("param.url应该是字符串类型html文件地址");return r.pjaxFormatHtml(e.url).then(function(t){var n=Object.assign(e,t);return r.of(n)})}}]),r}();exports.default=s;
},{"../utils":9}],18:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../dom"),e=s(t);function s(t){return t&&t.__esModule?t:{default:t}}var i={query:"mission-list-item",url:"./assets/components/missionListItem.html",selectors:{content:".item-content",date:".item-date"},created:function(){console.log("mission-lisi-item",this),e.default.of(this.elements.content).attr("text",this.present.content),e.default.of(this.elements.date).attr("text",this.present.date),e.default.of(this.elements.template).attr("id",this.present.id)}};exports.default=i;
},{"../dom":2}],13:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../dom"),t=d(e),n=require("../lib/datepicker"),a=d(n),o=require("../indexeddb/missions"),s=d(o),u=require("./component"),r=d(u),i=require("./missionListItem"),l=d(i);function d(e){return e&&e.__esModule?e:{default:e}}var f={query:"mission-content",url:"./assets/components/missionInbox.html",data:{counter:0},selectors:{form:".form",showForm:".show-form",contentInput:"input[name=content]",dateInput:"input[name=date]",cancelForm:".cancel-form",submit:".submit",list:".body ul"},methods:{createMission:function(){var e=this,n=t.default.of(this.elements.contentInput).attr("value"),a=t.default.of(this.elements.dateInput).attr("value");if(!n)return!1;this.data.counter+=1;var o={content:n,date:a,order:this.data.counter};return s.default.ready().then(function(){return s.default.create(o)}).then(function(n){var a=t.default.of("<mission-list-item>").dom;t.default.of(e.elements.list).append(a),l.default.present=o,r.default.pjaxCreate(l.default),t.default.of(e.elements.contentInput).attr("value",""),t.default.of(e.elements.dateInput).attr("value","")}),t.default.of(this.elements.form).attr("data-item-id",""),this}},created:function(){var e=this;(0,a.default)(this.elements.dateInput),t.default.of(this.elements.showForm).on("click",function(n){t.default.of(e.elements.form).attr("data-item-id","").removeClass("hide"),n.preventDefault(),e.elements.contentInput.focus()}),t.default.of(this.elements.cancelForm).on("click",function(){t.default.of(e.elements.form).addClass("hide"),e.elements.contentInput.blur()}),t.default.of(this.elements.submit).on("click",function(){t.default.of(e.elements.form).attr("data-item-id")||e.methods.createMission()})}};exports.default=f;
},{"../dom":2,"../lib/datepicker":5,"../indexeddb/missions":4,"./component":12,"./missionListItem":18}],6:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./component"),t=c(e),n=require("./inbox"),o=c(n);function c(e){return e&&e.__esModule?e:{default:e}}var r={query:"mission-content",url:"./assets/components/mission-today.html",created:function(){console.log("created",r.template)}},u={query:"mission-content",url:"./assets/components/mission-next-week.html",created:function(){console.log("created",u.template)}},a=function(){document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("#inbox"),n=document.querySelector("#today"),c=document.querySelector("#next-week");n.onclick=function(){t.default.pjaxCreate(r)},c.onclick=function(){t.default.pjaxCreate(u)},e.onclick=function(){t.default.pjaxCreate(o.default)},e.click()})};exports.default=a;
},{"./component":12,"./inbox":13}],1:[function(require,module,exports) {
"use strict";var e=require("./indexeddb/missions"),n=l(e),t=require("./dom"),i=l(t),r=require("./mission"),u=l(r),o=require("./lib/datepicker"),d=l(o),a=require("./components/main"),s=l(a);function l(e){return e&&e.__esModule?e:{default:e}}var c=i.default.of;document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("input[name=date]"),t=new u.default;window.mission=t,window.$=c,t.createMission(),window.show=function(){return n.default.ready().then(function(){return n.default.getAll()}).then(function(e){return console.log(e)})},(0,d.default)(e)}),(0,s.default)();
},{"./indexeddb/missions":4,"./dom":2,"./mission":3,"./lib/datepicker":5,"./components/main":6}]},{},[1], null)
//# sourceMappingURL=/index.map